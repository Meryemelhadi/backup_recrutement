<?xml version="1.0"?> 
<!DOCTYPE nxl [
<!ENTITY eacute "&#233;"> 
<!ENTITY agrave "&#192;">
]>
<nxl 
	version				= "1.0"
	xmlns				= "http://www.nxfrontier.com/nxl/nxl" 
	xmlns:site_config	= "http://www.nxfrontier.com/site_config"
	config				= "site_config"
	package				= "recruitment">
	
	
	

	<!-- data -->
	<data xmlns="http://www.nxfrontier.com/dml/dml">
		<tables>
			<table name="rct_vacancy">

				<fields>

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />

					<!-- meta données d'état -->

					<field name="code" label="code" type="line" />
					<field name="name" label="name" type="line" />

					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer"/>

					<field name="job_email" label="job_email" type="email" />
					<!-- date annonce -->
					<field name="announce_date" label="announce_date" type="date" />
					<field name="closing_announce_date" label="closing_announce_date" type="date" />

					<!-- début / fin -->
					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />
					
					<!-- resp RH -->
					<field name="manager_oid" label="manager_oid" type="text-choice" />

					<!-- manager ayant demandé l'ouverture du poste -->
					<field name="client_oid" label="client_oid" type="text-choice-table" />

					<!-- 
						cycle de vie du poste :
						0 : En cours, 1:Suspendu, 2:Clôturé, 3:En brief
					-->
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />

					<!-- 
						phases du recrutement
							0:Poste ouvert
							1:Validation de la demande d'ouverture
							2:Sollicitation de cabinets de recrutement
							3:Association de CV au poste
							4:Envoi de candidats aux clients internes
							5:Envoi de short-list aux clients internes
							6:Planification d'entretiens
							7:Acceptation de proposition
							8:Refus de proposition
							9:Candidat(s) retenu(s) pour le poste
							10:Sélection de candidat(s) annulée
							11:Proposition(s) envoyée(s)
					-->
					<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />

					<!-- 
						recruitment.workflow_state:
							1: Demande en attente
							2: Demande validée
							3: Demande refusée
					 -->					
					<field name="workflow_state" label="workflow_state" type="integer" sqlType="integer" />
					<field name="request_date" label="request_date" type="timestamp" />
					<field name="requested_by" label="requested_by" type="ref-oid" sqlType="integer" />

					<field name="validation_state" label="validation_state" type="text-choice" list="recruitment.validation_state" control="select" sqlType="integer" />

					<field name="archive_state" label="archive_state" type="text-choice" list="recruitment.archive_state" control="select" sqlType="integer" />				
					
					<field name="type_ao" label="type_ao" type="text-choice" list="recruitment.type_ao" control="select" sqlType="integer" />
					<!-- 
						PERMISSIONS 
					-->
					
					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="ref-oid" sqlType="integer" />	
									
					<!--droit de consultation du dossier -->
					<field name="groups_user_readonly" label="groups_user_readonly" type="text-choice-table" />
					
					<!--control total sur dossier -->
					<field name="groups_user_total_control" label="groups_user_total_control" type="text-choice" />


					<!-- 
						canaux de recherche des candidats 
					-->
					<field name="application_type" label="application_type" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true" default="0" />


					<!-- informations -->

					<field name="number" label="number" type="integer" default="1"/>

					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />				
				
					<field name="recruitment_motivation" label="recruitment_motivation" type="text" />

				
					<field name="work_schedule" label="work_schedule" type="line" />
					<field name="years_of_practice"	type="integer" />
					<field name="years_of_practice_max"  type="integer" />

					<field name="suited_diplomas" label="suited_diplomas" type="text" />
					<field name="companies_having_same_profile" label="companies_having_same_profile" type="text" />
					<field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." />
					<field name="technical_qualifications" label="technical_qualifications" type="rich-text" />
					<field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text" />
					<!--<field name="mission_definitions" label="mission_definitions" type="text" />-->
					<field name="organisme_definitions" label="organisme_definitions" type="rich-text" />
					<field name="mission_definitions" label="mission_definitions" type="rich-text" />
					<field name="mission_means" label="mission_means" type="rich-text" />
					<field name="mission_start_date" label="mission_start_date" type="date" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />
					<field name="taking_office_date" label="taking_office_date" type="date" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />
					<field name="synthesis_writing_state" label="synthesis_writing_state" type="date" />
					<field name="announcement_broadcasting_state" label="announcement_broadcasting_state" type="date" />					
			

					<field name="internship_title" label="internship_title" type="line" />
					<field name="internship_start" label="internship_start" type="date" />
					<field name="internship_end" label="internship_end" type="date" />					

					<field name="executive_committee_presentation" label="executive_committee_presentation" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" />
					<field name="email" label="email" type="email" />
					<field name="descriptionProfil" label="descriptionProfil" type="rich-text" csslayout="normal-layout" />

					 
					<!-- ================ Champs de lydec  ========================= -->
					<field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" />
					<field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					<field name="vacancy_lydec" label="vacancy" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="oid" label="oid" type="oid" isKey="primary" show ="hidden" isEdit="no" />
					<field name="budget_O_N" label="budget_O_N" type="line" />
					<field name ="budget" label ="budget" type ="line" />
					<field name ="csp" label="csp" type="text-choice" control="select" multiple="false" ds="db:directory_csp@admin" ds_format="{field:csp_name}"  ds_field_value="oid" sqlType="integer" />
					<field name="cc" label="cc" type="line" />
					<field name="version" label="version" type="line" />
					<field name="Cout" label="cout" type="line" />
					
					<!-- project -->
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.list@recruitment" ds_format="{field:name}"  default = "0" ds_field_value="oid" sqlType="integer" />
					<!-- connected application -->
					<field name="app_connected" label="app_connected" type="text-choice" />
					
					<!-- ========= Myfowo ========= -->
					<field name="salary_min" label="salary_min" type="line" />
					<field name ="salary_max" label ="salary_max" type ="line" />
					<field name ="salary_type" label ="salary_type" type="text-choice" list="recruitment.salary_type" control="select" sqlType="integer" />
					
					<!-- ====== Evaluation ====== -->
					<field name="evaluation_criteria" label="evaluation_criteria" type="text-choice" ds="db:rct_interview_default_criteria.ds_list@recruitment" control="checkbox" ds_format="{field:name}" ds_field_value="oid" sqlType="varchar(255)" controlLayout="table" columns="2" prompt="select criteria ..." multiple="true"/>
					<field 
						name		= "offers_list" 
						label		= "offers_list" 
						type		= "records" 
						ds			= "db:rct_vacancy_provider.list"
						ds_record	= "db:rct_vacancy_provider.record"
						key			= "oid"
						fkey		= "vacancy_oid"
						view		= "recruitment.vacancies.components.offer"
						edit_view	= "recruitment.vacancies.components.offer"
					/>
					
					<!-- ====== Job sector ====== -->
					<field 
						name			= "sector_oid"
						label			= "sector_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "sector_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:rct_job_sector.list@recruitment3"
						ds_link			= "rct_vacancy_sector"
						ds_format		= "{field:name}"
						ds_field_value	= "oid" />
						
					<field name="vacancy_success" label="vacancy_success" type="text-choice" list="recruitment.vacancy_success" control="select" sqlType="integer" />
					
				</fields>

				<key mode="by_user_and_candidate">
					<field table="rct_candidate_vacancy" name="candidate_oid"  type="ref-oid" value="%{request:oid}"/>
					<field name="workflow_state" type="integer" value="2" />
					<field name="archive_state" type="integer" relation="EQ" value="0" />
					<or>
						<field name="client_oid" type="text-choice" relation="like" value="%{user:oid}" pattern_match_left="%|" pattern_match_right="|%" />
						<field name="creator" type="integer" value="%{user:oid}" />
						<field name="requested_by" type="integer" value="%{user:oid}" />
					</or>
				</key>
				<group_by mode="by_user_and_candidate">
					<field name="oid" label="oid" type="oid" />
				</group_by>
				<fields mode="by_user_and_candidate">
					<field name="oid" label="oid" type="oid" isKey="primary" />
                    
				</fields>

				<key mode="manager_permission">
					<field name="oid" type="oid" relation="EQ" value="%{property:vacancy_id}"  />
					<field name="manager_oid" type="text-choice" relation="EQ" value="%{user:oid}"  />
				</key>
				<fields mode="manager_permission">
					<field name="oid" type="oid"/>
				</fields>
				<key mode="get_manager_oid">
                    <field name="oid" type="oid" relation="EQ" value="%{property:vacancy_oid}" />
                </key>
                <fields mode="get_manager_oid">
                    <field name="manager_oid" type="ref-oid"   />
                    <field name="establishment" label="establishment" type="ref-oid" />
                </fields>
			
				<!-- la liste de tous les dossiers pour alimenter le plan de recrutement en format excel -->
				<key mode="plan_excel">

					<field name="name" type="line" relation="LIKE" />
					<field name="code" type="line" relation="LIKE" />
					<field name="category_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="subsidiary_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="contract_type_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="service_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="duty_station_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="current_step" type="integer" relation="EQ-OR-NULL" />
					<field name="progress_level" type="integer" relation="EQ-OR-NULL" />
					<field name="application_type" type="integer" relation="match" />
					<field name="opening_date" type="date" relation="EQ-OR-NULL" />
					<field name="closing_date" type="date" relation="EQ-OR-NULL" />
					<field name="workflow_state" type="integer" value="2" />
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" />
				</key>

				<sort mode="plan_excel">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>

				<fields mode="plan_excel">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" alias="name"  label="name" type="line" />
					<field name="job_email" label="job_email" type="email" />
					
					<field name="budget_O_N" label="budget_O_N" type="text-choice" list="recruitment.budget" control="radio" sqlType="integer" />
					<field name ="budget" label ="budget" type ="line" />
					
					<field name="opening_date" label="opening_date" type="timestamp" format="%B %Y" />

					<!-- C/R -->
					<field name ="csp" label="csp" type="text-choice" control="select" multiple="false" ds="db:directory_csp@admin" ds_format="{field:csp_name}"  ds_field_value="oid" sqlType="integer" />
					
					<!-- Etat du dossier name au lieu de num -->
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step"  sqlType="integer" />
					
					<!-- CC , version , Ti -->
					<field name="cc" label="cc" type="line" />
					<field name="version" label="version" type="line" />

					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					
					<!-- Pôle et direction -->
					<field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					<field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />

					<!-- Côut -->
					<field name="cout" label="cout" type="line" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}" 
						ds_field_value="oid" sqlType="integer"/>

				</fields>
				

				<key mode="record">
					<field name="oid" type="oid" />
				</key>
				
				<key mode="find_by_email">
					<field name="job_email" label="job_email" type="email" relation="=" 
						value="%{property:job_email}"/>
				</key>
				<fields mode="find_by_email">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				
				<key mode="record_manager">
					<field name="oid" type="oid" relation="EQ" value="%{property:vacancy_oid}"/>
				</key>
				<fields mode="record_manager">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>
					<field name="creator" label="creator" type="ref-oid" sqlType="integer" />	
				</fields>


				<key mode="find_by_code">
					<field name="code" label="oid" type="line" relation="LIKE" value="%{property:vacancy_code}" />
				</key>
				<fields mode="find_by_code">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				
				<key mode="find_name_by_oid">
					<field name="oid" label="oid" type="oid" relation="EQ" value="%{property:vacancy_oid}" />
				</key>
				<fields mode="find_name_by_oid">
					<field name="name" label="name" type="line"/>
				</fields>


				<query mode="max_oid" type="select">
					SELECT MAX(_oid) AS _oid FROM _rct_vacancy
				</query>
				<fields mode="max_oid">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				

				<key mode="validate_vacancy">
					<field name="oid" type="oid" />
				</key>
				<fields mode="validate_vacancy">
					<field name="workflow_state" label="workflow_state" type="integer" value="%{request:validation_key}" />
					<field name="opening_date" label="opening_date" type="timestamp" value="now" />
					<field name="progress_level" label="progress_level" type="integer" value="0" />
					<field name="current_step" label="current_step" type="integer" value="0" />
				</fields>

				
				<fields mode="search">
					<field name="name" label="name" type="line" />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" prompt="current_step ..." value="%{request:current_step|0}" />						
					<field name="workflow_state" label="workflow_state" type="text-choice" list="recruitment.workflow_state" control="select" sqlType="integer" />

					<field name="opening_date" label="opening_date" type="date" />										

					<field name="code" label="code" type="line" />					

					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />

					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="closing_date" label="closing_date" type="date" format="%d %B %Y" />

					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />

					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />

					<field name="application_type" type="text-choice" list="recruitment.application_type" multiple="false" control="select" sqlType="char(6)" />
					
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="select" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />	
					<field name="archive_state" label="archive_state" type="text-choice" list="recruitment.archive_state" control="select" sqlType="integer" value="%{request:archive_state|0}" />		
					<!-- project -->
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.list@recruitment" ds_format="{field:name}"  default = "0" ds_field_value="oid" sqlType="integer" />
					
					<!-- connected application -->
					<field name="app_connected" label="app_connected" type="text-choice" ds="db:app_connected.list@recruitment" control="select" multiple="false" ds_format="{field:name}"  ds_field_value="oid" sqlType="integer" />
				</fields>
				
			<!--
				Liste de données (Text-choice)
			-->			
				
				<sort mode="ds_list">
					<field name="name" label="name" type="line" direction="asc" />
				</sort>
				
				<key mode="ds_list">
					<field name="oid" label="oid" type="oid" relation="in" value="%{property:cat.enum}"/>
				</key>

				<sort mode="ds_list">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>
				
				<fields mode="ds_list">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />
				</fields>
				<query mode="vlist" type="select">
				    SELECT distinct
                      IFNULL(_rct_interview._vacancy_oid,IFNULL(VAC2._oid,0)) as _oid,
                      IFNULL(VAC._name,IFNULL(VAC2._name,0)) as _name
                    FROM _rct_interview JOIN _rct_interview_by
                    LEFT JOIN _rct_candidate ON _rct_candidate._oid = _rct_interview._candidate_oid
			        LEFT JOIN _rct_vacancy AS VAC ON VAC._oid = _rct_interview._vacancy_oid
                    LEFT JOIN (
                        SELECT
                            _candidate_oid,_vacancy_oid as _v_oid
                        FROM
                            _rct_candidate_vacancy
                        GROUP BY _rct_candidate_vacancy._candidate_oid
                        ORDER BY _add_date DESC
                    ) AS CAND_VAC ON CAND_VAC._candidate_oid = _rct_candidate._oid
                    --  LEFT JOIN _rct_candidate_vacancy AS CAND_VAC ON CAND_VAC._candidate_oid = CAND._oid
			        LEFT JOIN _rct_vacancy AS VAC2 ON VAC2._oid = CAND_VAC._v_oid
                    WHERE (_rct_interview_by._key=_rct_interview._oid
                            AND (_rct_interview_by._val=".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."
                            OR _rct_interview._created_by=".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."
							OR _rct_interview_by._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."')
							OR _rct_interview._created_by in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."')
							) 
							AND IFNULL(_rct_interview._vacancy_oid,IFNULL(VAC2._oid,0)) != 0)
                    ORDER BY _name DESC
				</query>
				<fields mode="vlist">
                    <field name="oid" label="oid" type="integer" is_transient="true" />
                    <field name="name" label="name" type="line"  is_transient="true" />
                </fields>
				
				<key mode="ds_list_all">
					<field name="workflow_state" type="integer" relation="EQ" value="2" />
					<field name="archive_state" type="integer" relation="NE" value="1" />
				</key>
				
				<sort mode="ds_list_all">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>
				
				<fields mode="ds_list_all">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />
				</fields>
				
				<query type="select" mode="vacancies_for_interview">
					select IFNULL( (SELECT _rct_vacancy._oid ,
											_rct_vacancy._name,
											_rct_vacancy._code
									FROM _rct_vacancy  
									Left join _rct_candidate_vacancy ON _rct_candidate_vacancy._vacancy_oid = _rct_vacancy._oid
									WHERE _rct_candidate_vacancy._candidate_oid = '".$this->getProperty("candidate_oid")."' ) ,
									(SELECT _rct_vacancy._oid ,
											_rct_vacancy._name,
											_rct_vacancy._code
									 FROM _rct_vacancy));
				</query>
				<fields mode="vacancies_for_interview">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />
				</fields>
				
				<key mode="change_progress_level">
					<field name="oid" type="oid" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="change_progress_level">				
					<field name="progress_level" type="integer" value="%{property:progress_level}" />
				</fields>			

			<!--

				Récupération du titre

			-->
				<key mode="get_title">
					<field name="oid" type="oid" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="get_title">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step@recruitment" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level@recruitment" control="select" sqlType="integer" />
				</fields>
				
			<!-- 
				Liste des dossiers pouvant être associés à un candidat
			-->

			
				<query mode="available_vacancies" type="select">
					SELECT 
						_oid, _name, _code
					FROM 
						_rct_vacancy 

					WHERE 
						_oid NOT IN (SELECT _vacancy_oid from _rct_candidate_vacancy where _candidate_oid = ".$_GET['candidate_oid'].")

						AND _archive_state <> 1
						AND _current_step = 0

					ORDER BY _name, _code
				</query>

				<fields mode="available_vacancies">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />
				</fields>


				<query mode="close_vacancy" type="update">

					UPDATE 
						_rct_vacancy 

					SET 
						_closing_date=NOW(), _current_step = 2 

					WHERE 
						_oid = '".$this->getProperty("vacancy_oid")."' 

					AND 
						_number <= (SELECT COUNT(*) FROM _rct_candidate_vacancy WHERE _vacancy_oid = '".$this->getProperty("vacancy_oid")."' AND _job_acceptance_state = '1')

				</query>


				<key mode="pending_list">
					<field name="workflow_state" type="integer" value="1" />
					<field name="current_step" type="integer" value="0" />
					<or>
						<and>
							<field table="rct_vacancy"  name="creator"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_total_control" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>

							<field table="rct_vacancy_total_control"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_readonly" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>

							<field table="rct_vacancy_readonly"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field  name="manager_oid"  type="ref-oid" value="%{user:user.oid}" />
						</and>
					</or>
				</key>
				<query mode="pending_list" type="select">
					SELECT distinct _rct_vacancy._oid AS rct_vacancy_oid,
									_rct_vacancy._code AS rct_vacancy_code,
									_rct_vacancy._name AS rct_vacancy_name,
									_rct_vacancy._number AS rct_vacancy_number,
									_rct_vacancy._progress_level AS rct_vacancy_progress_level,
									_rct_vacancy._workflow_state AS rct_vacancy_workflow_state,
									_rct_vacancy._request_date AS rct_vacancy_request_date,
									_rct_vacancy._requested_by AS rct_vacancy_requested_by,
									_rct_vacancy._manager_oid AS rct_vacancy_manager_oid 
					FROM _rct_vacancy
					LEFT JOIN _rct_vacancy_total_control ON _rct_vacancy._oid = _rct_vacancy_total_control._key
					LEFT JOIN _rct_vacancy_readonly ON _rct_vacancy._oid = _rct_vacancy_readonly._key
					WHERE _rct_vacancy._workflow_state='1' 
						  AND _rct_vacancy._current_step='0' 
						  AND ((_rct_vacancy._creator='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."')  OR (_rct_vacancy_total_control._key=_rct_vacancy._oid 
						  AND _rct_vacancy_total_control._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."')  OR (_rct_vacancy_readonly._key=_rct_vacancy._oid 
						  AND _rct_vacancy_readonly._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."')  OR (_rct_vacancy._manager_oid='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."') OR (_rct_vacancy._manager_oid IS NULL OR _rct_vacancy._manager_oid ='?') )  
					ORDER BY _rct_vacancy._name ASC,_rct_vacancy._code ASC 
				</query>
				<sort mode="pending_list">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>

				<fields mode="pending_list">
					<field name="oid" label="oid" type="oid" isKey="primary" show="true" />
					<field name="code" label="code" type="line" direction="asc" />
					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1" />					
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />

					<field name="workflow_state" label="workflow_state" type="text-choice" list="recruitment.workflow_state" control="select" sqlType="integer" />
					<field name="request_date" label="request_date" type="timestamp" format="%d %B %Y &amp;agrave; %H:%M" />
					<field name="requested_by" label="requested_by" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
				
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>
				</fields>

				<key mode="pending_client_list">
					<or>
						<and>
							<field name="workflow_state" type="integer" value="1" />
							<!--<field name="requested_by" label="requested_by" type="integer" value="%{user:oid}" />-->
						</and>

						<and>
							<field name="workflow_state" type="integer" value="3" />
							<!--<field name="requested_by" label="requested_by" type="integer" value="%{user:oid}" />-->
						</and>
					</or>	
					<and>
						<or>
							<field name="client_oid" type="text-choice" relation="like" value="%{user:oid}" pattern_match_left="%|" pattern_match_right="|%" />
							<field name="creator" type="integer" value="%{user:oid}" />
							<field name="requested_by" type="integer" value="%{user:oid}" />
						</or>
					</and>				
				</key>
				<sort mode="pending_client_list">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>

				<fields mode="pending_client_list">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="code" label="code" type="line" direction="asc" />
					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>					

					<field name="workflow_state" label="workflow_state" type="text-choice" list="recruitment.workflow_state" control="select" sqlType="integer" />
					<field name="request_date" label="request_date" type="timestamp" format="%d %B %Y &amp;agrave; %H:%M" />
					<field name="requested_by" label="requested_by" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />

				</fields>


				<key mode="pending_item">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</key>
				<fields mode="pending_item">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>					

					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="mission_start_date" label="mission_start_date" type="date" format="%d %B %Y" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date"  format="%d %B %Y" />



					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />

					<field name="work_schedule" label="work_schedule" type="line" />
					<field name="years_of_practice" control="range" label="years_of_practice" type="integer" prompt_min="min" prompt_max="max"/>

					<field name="suited_diplomas" label="suited_diplomas" type="line" />
					<field name="companies_having_same_profile" label="companies_having_same_profile" type="line" />

					<field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." />

					<field name="technical_qualifications" label="technical_qualifications" type="rich-text"/>
					<field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text"/>

					<!--<field name="mission_definitions" label="mission_definitions" type="text" multiLines="auto" size="255" />-->
					<field name="mission_definitions" label="mission_definitions" type="rich-text" />
					<field name="organisme_definitions" label="organisme_definitions" type="rich-text" />
					<field name="mission_means" label="mission_means" type="rich-text" />

					<field name="workflow_state" label="workflow_state" type="text-choice" list="recruitment.workflow_state" control="select" sqlType="integer" />
					<field name="request_date" label="request_date" type="timestamp" format="%d %B %Y &amp;agrave; %H:%M" />
					<field name="requested_by" label="requested_by" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
				</fields>

				<pages mode="client_list" alias="page" pageOffset="%{get:page}" recordsPerPage="10" />
				<key mode="client_list">

					<field name="name" type="line" relation="LIKE" />
					<field name="code" type="line" relation="LIKE" />
					<field name="category_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="establishment" label="establishment"  relation="EQ-OR-NULL"  
						multiLines="no" type="text-choice" multiple="false" 
						control="select" 
						ds="entities.my_entities.ds_list@admin2" 
						ds_format="{field:entity_name}" 
						ds_field_value="oid" 
						isKey="secondary" 
						
					/>
					<field name="subsidiary_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="service_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="contract_type_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="duty_station_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="current_step" type="integer" relation="EQ-OR-NULL" />
					<field name="progress_level" type="integer" relation="EQ-OR-NULL" />
					<field name="application_type" type="integer" relation="match" />
					<field name="opening_date" type="date" relation="EQ-OR-NULL" />
					<field name="closing_date" type="date" relation="EQ-OR-NULL" />
					<field name="workflow_state" type="integer" value="2" />
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" />
					<or>
						<field name="client_oid" type="text-choice" relation="like" value="%{user:oid}" pattern_match_left="%|" pattern_match_right="|%" />
						<field name="creator" type="integer" value="%{user:oid}" />
						<field name="requested_by" type="integer" value="%{user:oid}" />
					</or>
				</key>
				<sort mode="client_list">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>
				<fields mode="client_list">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />

					<!-- Colonne 1 -->

					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}" 
						ds_field_value="oid" sqlType="integer"/>

					<!-- Colonne 2 -->
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />					

					<!-- Colonne 3 -->
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />
				

					<!--<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />-->
					<field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>

					<!-- Colonne 4 -->
					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />
					<field name="candidates_count" label="candidates_count" type="integer" is_transient="true" />
					<field name="rekrute_count" label="rekrute_count" type="integer" is_transient="true" />
					
				</fields>	

				<key mode="client_list_search">
					<field name="workflow_state" type="integer" value="2" />
					<field name="archive_state" type="integer" value="0" />
					<or>
						<field name="client_oid" type="text-choice" relation="like" value="%{user:oid}" pattern_match_left="%|" pattern_match_right="|%" />
						<field name="creator" type="integer" value="%{user:oid}" />
						<field name="requested_by" type="integer" value="%{user:oid}" />
					</or>
				</key>
				<sort mode="client_list_search">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>
				<fields mode="client_list_search">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />
				</fields>
								
			<!--
				Liste de données (Affichage)
			-->	
				
				<pages mode="list" alias="page" pageOffset="%{get:page}" recordsPerPage="10" />
				<group_by mode="list">
					<field name="oid" label="oid" type="oid" />
				</group_by>

				<sort mode="list">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>

				<!-- <sort mode="list">
					<field name="name" label="name" type="line" direction="asc" />
				</sort>
 -->				
				<key mode="list">
			
					<or>
						<and>
							<field table="rct_vacancy"  name="creator"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_total_control" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>

							<field table="rct_vacancy_total_control"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_readonly" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>

							<field table="rct_vacancy_readonly"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field  name="manager_oid"  type="ref-oid" value="%{user:user.oid}" />
						</and>
					</or>

					<field name="name" type="line" relation="LIKE" />
					<field name="code" type="line" relation="LIKE" />
					<field name="category_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="vacancy_project" type="integer" relation="EQ-OR-NULL" />
					<field name="app_connected" type="integer" relation="EQ-OR-NULL" />
					<field name="establishment" label="establishment" relation="eq-match" 
						multiLines="no" type="text-choice" multiple="false" control="select"
						ds="entities.my_entities.ds_list@admin2" 
						ds_format="{field:entity_name}" 
						ds_field_value="oid" 
						isKey="secondary" />

					<field name="subsidiary_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="service_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="duty_station_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="current_step" type="integer" relation="EQ-OR-NULL" />
					<field name="progress_level" type="integer" relation="EQ-OR-NULL" />
					<field name="application_type" type="integer" relation="match" />
					<field name="opening_date" type="date" relation="EQ-OR-NULL" />
					<field name="closing_date" type="date" relation="EQ-OR-NULL" />
					<field name="workflow_state" type="integer" value="2" />			
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" />

				</key>
				<query mode="list">
					SELECT 
						_rct_vacancy._oid AS rct_vacancy_oid,
						R_CTRL._key AS rct_vacancy_readonly_key,
						T_CTRL._key AS rct_vacancy_total_control_key,
						_rct_vacancy._manager_oid AS rct_vacancy_manager_oid,
						_rct_vacancy._name AS rct_vacancy_name,
						_rct_vacancy._number AS rct_vacancy_number,
						_rct_vacancy._code AS rct_vacancy_code,
						_rct_vacancy._email AS rct_vacancy_email,
						_rct_vacancy._category_oid AS rct_vacancy_category_oid,
						_rct_vacancy._contract_type_oid AS rct_vacancy_contract_type_oid,
						_rct_vacancy._subsidiary_oid AS rct_vacancy_subsidiary_oid,
						_rct_vacancy._establishment AS rct_vacancy_establishment,
						_rct_vacancy._service_oid AS rct_vacancy_service_oid,
						_rct_vacancy._duty_station_oid AS rct_vacancy_duty_station_oid,
						_rct_vacancy._current_step AS rct_vacancy_current_step,
						_rct_vacancy._progress_level AS rct_vacancy_progress_level,
						_rct_vacancy._application_type AS rct_vacancy_application_type,
						_rct_vacancy._opening_date AS rct_vacancy_opening_date,
						_rct_vacancy._closing_date AS rct_vacancy_closing_date,
						_rct_vacancy._creator AS rct_vacancy_creator,
						_rct_vacancy._vacancy_project AS rct_vacancy_vacancy_project

					FROM 
						_rct_vacancy
						LEFT JOIN _rct_vacancy_total_control AS T_CTRL ON T_CTRL._key = _rct_vacancy._oid 
						LEFT JOIN _rct_vacancy_readonly		 AS R_CTRL ON R_CTRL._key = _rct_vacancy._oid
						 
					WHERE 
						(
							_rct_vacancy._creator='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							T_CTRL._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							R_CTRL._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							_rct_vacancy._manager_oid='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							_rct_vacancy._creator in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							T_CTRL._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							R_CTRL._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							_rct_vacancy._manager_oid in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') 
						)
						AND
							".$this->getWhereClause("_rct_vacancy._name",$this->getFieldParam("name","null","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND
							".$this->getWhereClause("_rct_vacancy._code",$this->getFieldParam("code","null","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._category_oid",$this->getFieldParam("category_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._vacancy_project",$this->getFieldParam("vacancy_project","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._app_connected",$this->getFieldParam("app_connected","0","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._establishment",$this->getFieldParam("establishment","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._subsidiary_oid",$this->getFieldParam("subsidiary_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._service_oid",$this->getFieldParam("service_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._duty_station_oid",$this->getFieldParam("duty_station_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._current_step",$this->getFieldParam("current_step","0","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._progress_level",$this->getFieldParam("progress_level","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._application_type",$this->getFieldParam("application_type","0","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._opening_date",$this->getFieldParam("opening_date","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._closing_date",$this->getFieldParam("closing_date","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							_rct_vacancy._workflow_state='2' AND 
							".$this->getWhereClause("_rct_vacancy._archive_state",$this->getFieldParam("archive_state","null","|",$record,""),'=','OR','','',true,false,'|','false')." 
							
						GROUP BY 
							_rct_vacancy._oid  

						ORDER BY 
							_rct_vacancy._vacancy_project DESC,
							_rct_vacancy._opening_date DESC,
							_rct_vacancy._name ASC,
							_rct_vacancy._code ASC 
				</query>

				<fields mode="list">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field table="rct_vacancy_readonly" name="key" alias= "key_readonly" type="ref-oid" />
					<field table="rct_vacancy_total_control" name="key" alias= "key_total_control" type="ref-oid" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					<!-- Colonne 2 -->
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					
					<!-- Colonne 3 -->
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />
					<!--<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />-->
					<field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>
					<field name="multiposting_status" label="multiposting_status" type="text-choice" control="select"  list="recrutementmp.jobboard_status@recruitmentmp" is_transient="true"  />
                    <field name="status_pourcent" label="status_pourcent" type="line" is_transient="true" />
					<field name="candidates_count" label="candidates_count" type="integer" is_transient="true" />
					<field name="rekrute_count" label="rekrute_count" type="integer" is_transient="true" />
					
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.all_list@recruitment" ds_format="{field:name}" default = "0" ds_field_value="oid" sqlType="integer" />

					<!-- Colonne 4 -->
					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />
					<field name="multiposting_clics" label="multiposting_clics" type="integer" is_transient="true" />
                    <field name="multiposting_oid" label="multiposting_oid" type="integer" is_transient="true" />


					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" />	
					<field name="email" label="email" type="email" />
					
				</fields>

				<query mode="list-drh">
					SELECT 
						_rct_vacancy._oid AS rct_vacancy_oid,
						R_CTRL._key AS rct_vacancy_readonly_key,
						T_CTRL._key AS rct_vacancy_total_control_key,
						_rct_vacancy._manager_oid AS rct_vacancy_manager_oid,
						_rct_vacancy._name AS rct_vacancy_name,
						_rct_vacancy._number AS rct_vacancy_number,
						_rct_vacancy._code AS rct_vacancy_code,
						_rct_vacancy._email AS rct_vacancy_email,
						_rct_vacancy._category_oid AS rct_vacancy_category_oid,
						_rct_vacancy._contract_type_oid AS rct_vacancy_contract_type_oid,
						_rct_vacancy._subsidiary_oid AS rct_vacancy_subsidiary_oid,
						_rct_vacancy._establishment AS rct_vacancy_establishment,
						_rct_vacancy._service_oid AS rct_vacancy_service_oid,
						_rct_vacancy._duty_station_oid AS rct_vacancy_duty_station_oid,
						_rct_vacancy._current_step AS rct_vacancy_current_step,
						_rct_vacancy._progress_level AS rct_vacancy_progress_level,
						_rct_vacancy._application_type AS rct_vacancy_application_type,
						_rct_vacancy._opening_date AS rct_vacancy_opening_date,
						_rct_vacancy._closing_date AS rct_vacancy_closing_date,
						_rct_vacancy._creator AS rct_vacancy_creator,
						_rct_vacancy._vacancy_project AS rct_vacancy_vacancy_project

					FROM 
						_rct_vacancy
						LEFT JOIN _rct_vacancy_total_control AS T_CTRL ON T_CTRL._key = _rct_vacancy._oid 
						LEFT JOIN _rct_vacancy_readonly		 AS R_CTRL ON R_CTRL._key = _rct_vacancy._oid
						 
					WHERE 
						
							".$this->getWhereClause("_rct_vacancy._name",$this->getFieldParam("name","null","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND
							".$this->getWhereClause("_rct_vacancy._code",$this->getFieldParam("code","null","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._category_oid",$this->getFieldParam("category_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._vacancy_project",$this->getFieldParam("vacancy_project","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._app_connected",$this->getFieldParam("app_connected","0","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._establishment",$this->getFieldParam("establishment","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._subsidiary_oid",$this->getFieldParam("subsidiary_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._service_oid",$this->getFieldParam("service_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._duty_station_oid",$this->getFieldParam("duty_station_oid","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._current_step",$this->getFieldParam("current_step","0","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._progress_level",$this->getFieldParam("progress_level","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._application_type",$this->getFieldParam("application_type","0","|",$record,""),'LIKE','OR','%','%',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._opening_date",$this->getFieldParam("opening_date","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							".$this->getWhereClause("_rct_vacancy._closing_date",$this->getFieldParam("closing_date","null","|",$record,""),'=','OR','','',true,false,'|','false')." AND 
							_rct_vacancy._workflow_state='2' AND 
							".$this->getWhereClause("_rct_vacancy._archive_state",$this->getFieldParam("archive_state","null","|",$record,""),'=','OR','','',true,false,'|','false')." 
							
						GROUP BY 
							_rct_vacancy._oid  

						ORDER BY 
							_rct_vacancy._vacancy_project DESC,
							_rct_vacancy._opening_date DESC,
							_rct_vacancy._name ASC,
							_rct_vacancy._code ASC 
				</query>
				
				<fields mode="list-drh">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field table="rct_vacancy_readonly" name="key" alias= "key_readonly" type="ref-oid" />
					<field table="rct_vacancy_total_control" name="key" alias= "key_total_control" type="ref-oid" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					<!-- Colonne 2 -->
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					
					<!-- Colonne 3 -->
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />
					<!--<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />-->
					<field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>
					<field name="multiposting_status" label="multiposting_status" type="text-choice" control="select"  list="recrutementmp.jobboard_status@recruitmentmp" is_transient="true"  />
                    <field name="status_pourcent" label="status_pourcent" type="line" is_transient="true" />
					<field name="candidates_count" label="candidates_count" type="integer" is_transient="true" />
					<field name="rekrute_count" label="rekrute_count" type="integer" is_transient="true" />
					
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.all_list@recruitment" ds_format="{field:name}" default = "0" ds_field_value="oid" sqlType="integer" />

					<!-- Colonne 4 -->
					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />
					<field name="multiposting_clics" label="multiposting_clics" type="integer" is_transient="true" />
                    <field name="multiposting_oid" label="multiposting_oid" type="integer" is_transient="true" />


					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" />	
					<field name="email" label="email" type="email" />
					
				</fields>
				
				
				<query mode="list-validation">
					SELECT 
						_rct_vacancy._oid AS rct_vacancy_oid,
						_rct_vacancy._manager_oid AS rct_vacancy_manager_oid,
						_rct_vacancy._name AS rct_vacancy_name,
						_rct_vacancy._number AS rct_vacancy_number,
						_rct_vacancy._code AS rct_vacancy_code,
						_rct_vacancy._category_oid AS rct_vacancy_category_oid,
						_rct_vacancy._contract_type_oid AS rct_vacancy_contract_type_oid,
						_rct_vacancy._subsidiary_oid AS rct_vacancy_subsidiary_oid,
						_rct_vacancy._establishment AS rct_vacancy_establishment,
						_rct_vacancy._service_oid AS rct_vacancy_service_oid,
						_rct_vacancy._duty_station_oid AS rct_vacancy_duty_station_oid,
						_rct_vacancy._current_step AS rct_vacancy_current_step,
						_rct_vacancy._progress_level AS rct_vacancy_progress_level,
						_rct_vacancy._application_type AS rct_vacancy_application_type,
						_rct_vacancy._opening_date AS rct_vacancy_opening_date,
						_rct_vacancy._closing_date AS rct_vacancy_closing_date,
						_rct_vacancy._creator AS rct_vacancy_creator,
						_rct_vacancy._vacancy_project AS rct_vacancy_vacancy_project

					FROM 
						_rct_vacancy
						 
					WHERE 
							_rct_vacancy._workflow_state='1' 
						GROUP BY 
							_rct_vacancy._oid  

						ORDER BY 
							_rct_vacancy._opening_date DESC,
							_rct_vacancy._name ASC,
							_rct_vacancy._code ASC 
				</query>
				<fields mode="list-validation">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field table="rct_vacancy_readonly" name="key" alias= "key_readonly" type="ref-oid" />
					<field table="rct_vacancy_total_control" name="key" alias= "key_total_control" type="ref-oid" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					<!-- Colonne 2 -->
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					
					<!-- Colonne 3 -->
					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />
					<!--<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />-->
					<field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>
					<field name="multiposting_status" label="multiposting_status" type="text-choice" control="select"  list="recrutementmp.jobboard_status@recruitmentmp" is_transient="true"  />
                    <field name="status_pourcent" label="status_pourcent" type="line" is_transient="true" />
					<field name="candidates_count" label="candidates_count" type="integer" is_transient="true" />
					<field name="rekrute_count" label="rekrute_count" type="integer" is_transient="true" />
					
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.all_list@recruitment" ds_format="{field:name}" default = "0" ds_field_value="oid" sqlType="integer" />

					<!-- Colonne 4 -->
					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />
					<field name="multiposting_clics" label="multiposting_clics" type="integer" is_transient="true" />
                    <field name="multiposting_oid" label="multiposting_oid" type="integer" is_transient="true" />


					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" />	
					
				</fields>

				<key mode="hp_list">
					<field  name="manager_oid"  type="ref-oid" relation="NEQ" value="%{user:user.oid}" />
					<field name="current_step" type="integer" value="0" />
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" value="0"/>
					
					<or>
						<field name="workflow_state" type="integer" value="1" />
						<field name="workflow_state" type="integer" value="2" />
					</or>
			
					<or>
						<and>
							<field name="client_oid" relation="eq-match" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_total_control" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>
							<field table="rct_vacancy_total_control"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_readonly" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>
							<field table="rct_vacancy_readonly"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
					</or>

				</key>
				
				<sort mode="hp_list">
					<field name="progress_level" direction="asc"/>
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>
				
				<group_by mode="hp_list">
					<field name="oid" label="oid" type="oid" />
				</group_by>

				<fields mode="hp_list">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field table="rct_vacancy_readonly" name="key" alias= "key_readonly" type="ref-oid" />
					<field table="rct_vacancy_total_control" name="key" alias= "key_total_control" type="ref-oid" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level@recruitment" 
						control="select" />

					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						ds_field_value	= "oid" />

					<field name="archive_state" label="archive_state" type="integer" value="0" show="hidden" />
				
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />

					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" />	

					<field name="count" label="count" type="line" />	
				</fields>
				<query mode="hp_list">

					SELECT 
						V._oid AS rct_vacancy_oid,
						RO._key AS rct_vacancy_readonly_key,
						TC._key AS rct_vacancy_total_control_key,
						V._progress_level AS rct_vacancy_progress_level,
						V._client_oid AS rct_vacancy_client_oid,
						V._archive_state AS rct_vacancy_archive_state,
						V._manager_oid AS rct_vacancy_manager_oid,
						V._name AS rct_vacancy_name,
						V._number AS rct_vacancy_number,
						V._code AS rct_vacancy_code,
						V._creator AS rct_vacancy_creator, 
						count(*) as rct_vacancy_count

					FROM 
						_rct_vacancy AS V
						LEFT JOIN _rct_vacancy_total_control AS TC ON TC._key=V._oid
						LEFT JOIN _rct_vacancy_readonly AS RO ON RO._key=V._oid
						LEFT JOIN _rct_candidate_vacancy AS CAND ON CAND._vacancy_oid=V._oid
						LEFT JOIN _rct_candidate ON _rct_candidate._oid = CAND._candidate_oid

					WHERE 
						V._manager_oid<>'".($U=$GLOBALS["_NX_user"]->getProperty("user.oid","",true))."' AND 
						V._current_step='0' AND 
						(V._archive_state = '0') AND 
						(V._workflow_state='1' OR V._workflow_state='2')  AND 

						(
							(V._client_oid='".$U."')  OR (TC._val='".$U."')  OR (RO._val='".$U."') 
						)
						AND _rct_candidate._oid IS NOT NULL

					GROUP BY 
						V._oid  

					ORDER BY 
						V._progress_level ASC,
						V._name ASC,
						V._code ASC

				</query>

				<!-- my vacancies list in home page (created by me or managed by me -->
				<key mode="my_hp_list">
					<field name="current_step" type="integer" value="0" />
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" value="0"/>
					<or>
						<field  name="manager_oid"  type="ref-oid" value="%{user:user.oid}" />
						<field  name="creator"  type="ref-oid" value="%{user:user.oid}" />
					</or>
					<or>
						<field name="workflow_state" type="integer" value="1" />
						<field name="workflow_state" type="integer" value="2" />
					</or>
				</key>
				
				<sort mode="my_hp_list">
					<field name="progress_level" direction="asc"/>
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>
				<fields mode="my_hp_list">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level@recruitment" 
						control="select" />

					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						ds_field_value	= "oid" />
					<field name="archive_state" label="archive_state" type="integer" value="0" show="hidden" />

					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"
					/>

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1" />
					<field name="code" label="code" type="line" />

					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" />	

					<field name="count" label="count" type="line" />
				</fields>
				<query mode="my_hp_list">

					SELECT 
						V._oid AS _oid,
						V._progress_level AS _progress_level,
						V._client_oid AS _client_oid,
						V._archive_state AS _archive_state,
						V._manager_oid AS _manager_oid,
						V._name AS _name,
						V._number AS _number,
						V._code AS _code,
						V._creator AS _creator,
						count(*) as _count
					
					FROM 
						_rct_vacancy as V
						LEFT JOIN _rct_candidate_vacancy AS CAND ON CAND._vacancy_oid=V._oid
						LEFT JOIN _rct_candidate ON _rct_candidate._oid = CAND._candidate_oid
					
					WHERE 
						V._current_step='0' AND
						".$this->getWhereClause("V._archive_state","'0'",'=','OR','','',true,false,'|','false')." AND
						( V._manager_oid='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR V._creator = '".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."') AND (_workflow_state='1' OR _workflow_state='2')
						AND _rct_candidate._oid IS NOT NULL
					
					GROUP BY CAND._vacancy_oid

					ORDER BY _progress_level ASC,_name ASC,_code ASC

				</query>

				<!-- la liste de tous les dossiers pour alimenter le fichier excel -->
				
				<pages mode="list_excel" alias="page" pageOffset="%{get:page}"/>
				 
				<group_by mode="list_excel">
					<field name="oid" label="oid" type="oid" />
				</group_by> 
				
				
				<key mode="list_excel">
			     
					<or>
						<and>
							<field table="rct_vacancy"  name="creator"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_total_control" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>

							<field table="rct_vacancy_total_control"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field table="rct_vacancy_readonly" name="key"  type="ref-oid" value="%{field:rct_vacancy.oid}%"/>

							<field table="rct_vacancy_readonly"  name="val"  type="ref-oid" value="%{user:user.oid}" />
						</and>
						<and>
							<field  name="manager_oid"  type="ref-oid" value="%{user:user.oid}" />
						</and>
					</or>

					<field name="name" type="line" relation="LIKE" />
					<field name="code" type="line" relation="LIKE" />
					<field name="category_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="vacancy_project" type="integer" relation="EQ-OR-NULL" />
					<field name="app_connected" type="integer" relation="EQ-OR-NULL" />
					<field name="establishment" label="establishment" relation="eq-match" 
						multiLines="no" type="text-choice" multiple="false" control="select"
						ds="entities.my_entities.ds_list@admin2" 
						ds_format="{field:entity_name}" 
						ds_field_value="oid" 
						isKey="secondary" />

					<field name="subsidiary_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="service_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="duty_station_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="current_step" type="integer" relation="EQ-OR-NULL" />
					<field name="progress_level" type="integer" relation="EQ-OR-NULL" />
					<field name="application_type" type="integer" relation="match" />
					<field name="opening_date" type="date" relation="EQ-OR-NULL" />
					<field name="closing_date" type="date" relation="EQ-OR-NULL" />
					<field name="workflow_state" type="integer" value="2" />			
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" />

				</key>
				<sort mode="list_excel">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>

				<fields mode="list_excel">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />

					<!-- Colonne 1 -->

					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					

					<!-- Colonne 2 -->

					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					
					<!-- Colonne 3 -->

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />

					<!--<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />-->

					<field name="application_type" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>
					<field name="candidates_count" label="candidates_count" type="integer" is_transient="true" show="hidden" />
					

					<!-- Colonne 4 -->

					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />

					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" show="hidden" />	
			

				</fields>
				<!-- la liste de tous les dossiers pour alimenter le fichier excel -->
				
				<pages mode="list_excel-drh" alias="page" pageOffset="%{get:page}"/>
				 
				<group_by mode="list_excel-drh">
					<field name="oid" label="oid" type="oid" />
				</group_by> 
				
				<key mode="list_excel-drh">

					<field name="name" type="line" relation="LIKE" />
					<field name="code" type="line" relation="LIKE" />
					<field name="category_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="vacancy_project" type="integer" relation="EQ-OR-NULL" />
					<field name="app_connected" type="integer" relation="EQ-OR-NULL" />
					<field name="establishment" label="establishment" relation="eq-match" 
						multiLines="no" type="text-choice" multiple="false" control="select"
						ds="entities.my_entities.ds_list@admin2" 
						ds_format="{field:entity_name}" 
						ds_field_value="oid" 
						isKey="secondary" />

					<field name="subsidiary_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="service_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="duty_station_oid" type="integer" relation="EQ-OR-NULL" />
					<field name="current_step" type="integer" relation="EQ-OR-NULL"/>
					<field name="progress_level" type="integer" relation="EQ-OR-NULL" />
					<field name="application_type" type="integer" relation="match" />
					<field name="opening_date" type="date" relation="EQ-OR-NULL" />
					<field name="closing_date" type="date" relation="EQ-OR-NULL" />
					<field name="workflow_state" type="integer" value="2" />			
					<field name="archive_state" type="integer" relation="EQ-OR-NULL" />

				</key>
				<sort mode="list_excel-drh">
					<field name="name" label="name" type="line" direction="asc" />
					<field name="code" label="code" type="line" direction="asc" />
				</sort>

				<fields mode="list_excel-drh">

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />

					<!-- Colonne 1 -->

					<field name="name" alias="name"  label="name" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					

					<!-- Colonne 2 -->

					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

					
					<!-- Colonne 3 -->

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />

					<!--<field name="progress_level" label="progress_level" type="integer" sqlType="integer" />-->

					<field name="application_type" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>
					<field name="candidates_count" label="candidates_count" type="integer" is_transient="true" show="hidden" />
					

					<!-- Colonne 4 -->

					<field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
					<field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />

					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="line" sqlType="integer" show="hidden" />	
			

				</fields>
			<!--

				Formulaire de demande

			-->

				<key mode="request">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />

				</key>

				<fields mode="request">	

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1" />					
					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer"/>
					 <field name="creator" label="creator" type="ref-oid" value="%{user:oid}" show="hidden" />

					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="mission_start_date" label="mission_start_date" type="date" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />



					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />

					<field name="work_schedule" label="work_schedule" type="line" />				

					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="suited_diplomas" label="suited_diplomas" type="line" />
					<field name="companies_having_same_profile" label="companies_having_same_profile" type="line" />
					<field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." />

					<field name="technical_qualifications" label="technical_qualifications" type="rich-text"/>
					<field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text"/>


					<!--<field name="mission_definitions" label="mission_definitions" type="text" multiLines="auto" size="255" />-->
					<field name="mission_definitions" label="mission_definitions" type="rich-text" />
					<field name="organisme_definitions" label="organisme_definitions" type="rich-text" />
					<field name="mission_means" label="mission_means" type="rich-text" />
					

					<field name="workflow_state" label="workflow_state" type="integer" show="hidden" value="1" />
					<field name="request_date" label="request_date" type="timestamp" show="hidden" value="now" />
					<field name="requested_by" label="requested_by" type="ref-oid" show="hidden" value="%{user:oid}" />

					<!--
					<field name="client_oid" type="text-choice" value="%{user:oid}" show="hidden" />
					-->
					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						value			= "|%{user:oid}|"
						show			= "hidden"
						ds_field_value	= "oid" />
					<field name="archive_state" label="archive_state" type="integer" value="0" show="hidden" />

				
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>						
				</fields>		
				
				<!--

				Formulaire d'édition d'une demande validée

				-->

				<key mode="edit-validate-request">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />

				</key>

				<fields mode="edit-validate-request">	

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1" />					
					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer"/>
					 <field name="creator" label="creator" type="ref-oid" value="%{user:oid}" show="hidden" />

					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="mission_start_date" label="mission_start_date" type="date" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />



					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />

					<field name="work_schedule" label="work_schedule" type="line" />				

					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="suited_diplomas" label="suited_diplomas" type="line" />
					<field name="companies_having_same_profile" label="companies_having_same_profile" type="line" />
					<field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." />

					<field name="technical_qualifications" label="technical_qualifications" type="rich-text"/>
					<field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text"/>


					<!--<field name="mission_definitions" label="mission_definitions" type="text" multiLines="auto" size="255" />-->
					<field name="mission_definitions" label="mission_definitions" type="rich-text" />
					<field name="mission_means" label="mission_means" type="rich-text" />
					

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="job_email" label="job_email" type="email" />
					<!--
					<field name="client_oid" type="text-choice" value="%{user:oid}" show="hidden" />
					-->
					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						value			= "|%{user:oid}|"
						show			= "hidden"
						ds_field_value	= "oid" />
					<field name="archive_state" label="archive_state" type="integer" value="0" show="hidden" />

				
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"				
						ds_field_value="oid" sqlType="integer"/>						
				</fields>		

				<key mode="request_email_data">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="request_email_data">

					<field name="name" label="name" type="line" />
					<field name="manager_oid" type="line" />
					<field name="requested_by" label="requested_by" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />

					<field name="to" label="to" type="line" is_transient="true" />
					<field name="first_name" label="first_name" type="line" is_transient="true" />
					<field name="subject" label="subject" type="line" is_transient="true" />
					<field name="body" label="body" type="line" is_transient="true" />
				</fields>

			<!--

				Formulaire d'ajout

			-->	

			
				<fields mode="add_default">	

					<field name="name" label="name" type="line" isRequired = "true" />
                    <field name="number" label="number" type="integer" default="1" value="1" />
                    <field
                        name			= "cand_channel"
                        label			= "cand_channel"
                        type			= "text-choice"
                        prompt			= "cand_channel..."
                        multiple		= "false"
                        control			= "select"
                        ds				= "db:rct_channel.ds_list@recruitment"
                        ds_format		= "{field:name}"
                        ds_field_value="oid" sqlType="integer"/>

                    <field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <!--<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />-->
                    <field name="contract_type_oid" label="contract_type_oid" type="text-choice" control="select"  multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <field name="mission_start_date" label="mission_start_date" type="date" />
                    <field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />
                    <field name="taking_office_date" label="taking_office_date" type="date" />
                    <field name="code" label="code" type="line" />

                    <!--<field name="client_oid" label="client_oid" type="text-choice" control="select" multiple="false" ds="db:user.ds_list_all@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" sqlType="integer" />-->



                    <!--<field name="client_oid" label="client_oid" type="text-choice" control="facebook_list" multiple="yes" ds="db:user.ds_list_all@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />-->





                    <field
                        name			= "manager_oid"
                        label			= "manager_oid"
                        type			= "text-choice"
                        prompt			= "manager_oid..."
                        multiple		= "false"
                        control			= "select"
                        ds				= "db:user.ds_list_all@recruitment"
                        ds_format		= "{field:first_name} {field:last_name}"
                        ds_field_value="oid" sqlType="integer"/>



                    <field
                        name			= "client_oid"
                        label			= "client_oid"
                        type			= "text-choice-table"
                        list			= "product_range"
                        prompt			= "client_oid..."
                        multiple		= "yes"
                        control			= "facebook_list"
                        ds				= "db:user.ds_list_all@recruitment"
                        ds_link			= "rct_vacancy_client"
                        ds_format		= "{field:first_name} {field:last_name}"
                        ds_field_value	= "oid" />

                    <field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" default="0" />
                    <field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" isEdit="no" value="0" />

                    <!--<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />-->

                    <field name="closing_date" label="closing_date" type="date" />
                    <field name="opening_date" label="closing_date" type="timestamp" value="now" show="hidden" />
					<field name="announce_date" label="announce_date" type="date" default="now" />
					<field name="closing_announce_date" label="closing_announce_date" type="date" />

                    <field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />

                    <field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
                    <field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />
                    <field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />

                    <field name="workflow_state" label="archive_state" type="integer" value="2" show="hidden"/>

                    <field name="internship_title" label="internship_title" type="line" />
                    <field name="internship_start" label="internship_start" type="date" />
                    <field name="internship_end" label="internship_end" type="date" />

                    <field name="archive_state" label="archive_state" type="integer" value="0" show="hidden" />

                    <field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
                    <!--Le créateur du dossier-->

                    <field name="creator" label="creator" type="ref-oid" value="%{user:oid}" show="hidden" />

                    <!--droit de consultation du dossier -->
                    <field name="groups_user_readonly" label="groups_user_readonly" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator_add" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_readonly"  ds_field_value="oid" />

                    <!--controle total du dossier -->

                    <field name="groups_user_total_control" label="groups_user_total_control" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator_add" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_total_control" ds_field_value="oid" />


                    <!--les champs de lydec -->
                    <field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />

                    <field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="pole ..." />
					<field name="email" label="email" type="email" />
					
					<!-- project -->
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.all_list@recruitment" ds_format="{field:name}"  default = "0" ds_field_value="oid" sqlType="integer" />
					<!-- connected application -->
					<field name="app_connected" label="app_connected" type="text-choice" ds="db:app_connected.list@recruitment" control="checkbox" multiple="true" ds_format="{field:name}"  ds_field_value="oid" sqlType="integer" />
				</fields>
				
				

				
				<fields mode="add_lydec">	

					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1" value="1" />					
					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer"/>

					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="mission_start_date" label="mission_start_date" type="date" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />
					<field name="taking_office_date" label="taking_office_date" type="date" />
					<field name="code" label="code" type="line" />

					<!--<field name="client_oid" label="client_oid" type="text-choice" control="select" multiple="false" ds="db:user.ds_list_all@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" sqlType="integer" />-->

					<!--<field name="client_oid" label="client_oid" type="text-choice" control="facebook_list" multiple="yes" ds="db:user.ds_list_all@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />-->


					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"					
						ds_field_value="oid" sqlType="integer"/>
				

					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						ds_field_value	= "oid" />

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" default="0" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" isEdit="no" value="0" />

					<!--<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />-->

					<field name="closing_date" label="closing_date" type="date" />
					<field name="opening_date" label="opening_date" type="timestamp" value="now" show="hidden" />

					

					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />


					<field name="workflow_state" type="integer" value="2" />
					<field name="internship_title" label="internship_title" type="line" />
					<field name="internship_start" label="internship_start" type="date" />
					<field name="internship_end" label="internship_end" type="date" />

					<field name="archive_state" label="archive_state" type="integer" value="0" show="hidden" />				
					
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<!--Le créateur du dossier-->
					
					<field name="creator" label="creator" type="ref-oid" value="%{user:oid}" show="hidden" />
					
					<!--droit de consultation du dossier -->	
					<field name="groups_user_readonly" label="groups_user_readonly" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator_add" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_readonly"  ds_field_value="oid" />
					
					<!--controle total du dossier -->
					
					<field name="groups_user_total_control" label="groups_user_total_control" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator_add" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_total_control" ds_field_value="oid" />
					
					
					<!--les champs de lydec -->
					<field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					<field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					<field name="budget_O_N" label="budget_O_N" type="text-choice" list="recruitment.budget" control="radio" sqlType="Integer" />
					<field name ="budget" label ="budget" type ="line" />
					<field name ="csp" label="csp" type="text-choice" control="select" multiple="false" ds="db:directory_csp@admin" ds_format="{field:csp_name}"  ds_field_value="oid" sqlType="integer" />
					<field name="cc" label="cc" type="line" />
					<field name="version" label="version" type="line" />
					<field name="Cout" label="cout" type="line" />
				</fields>

			<!--

				Formulaire d'édition

			-->

				<key mode="change_application_type">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="change_application_type">
					<field name="application_type" type="text-choice" value="%{property:application_type}" />
				</fields>	

				<key mode="delete">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</key>

				<fields mode="delete">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>

				<key mode="archive">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</key>

				<fields mode="archive">
					<field name="archive_state" label="archive_state" type="integer" value="1" />
				</fields>

				<key mode="edit_default">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</key>
				<!--<query mode="edit_default" type="select">
					SELECT 	_rct_vacancy._oid,_rct_vacancy._name,_rct_vacancy._number,_rct_vacancy._cand_channel,_rct_vacancy._category_oid,_rct_vacancy._contract_type_oid,_rct_vacancy._mission_start_date,_rct_vacancy._suited_recruitment_date,_rct_vacancy._taking_office_date,_rct_vacancy._code,_rct_vacancy._archive_state,_rct_vacancy._creator,_rct_vacancy._manager_oid,_rct_vacancy._client_oid,_rct_vacancy._current_step,_rct_vacancy._progress_level,_rct_vacancy._closing_date,_rct_vacancy._duty_station_oid,_rct_vacancy._direction,_pole,_rct_vacancy._service_oid,_rct_vacancy._establishment,_rct_vacancy._subsidiary_oid,_rct_vacancy._application_type,_rct_vacancy._opening_date,_rct_vacancy._groups_user_readonly,_rct_vacancy._groups_user_total_control,_rct_vacancy._internship_title,_rct_vacancy._internship_start,_rct_vacancy._internship_end,_rct_vacancy._executive_committee_presentation,_rct_vacancy._work_schedule,_rct_vacancy._years_of_practice,_rct_vacancy._years_of_practice_max,_rct_vacancy._suited_diplomas,_rct_vacancy._companies_having_same_profile,_rct_vacancy._recruitment_reasons,_rct_vacancy._technical_qualifications,_rct_vacancy._behavioral_qualifications,_rct_vacancy._mission_definitions,_rct_vacancy._mission_means,_rct_vacancy._descriptionProfil , VP._date AS _date , VP._provider_oid , VP._active
					FROM _rct_vacancy 
					LEFT JOIN _rct_vacancy_provider as VP ON VP._vacancy_oid = _rct_vacancy._oid
					LEFT JOIN _rct_provider as P ON P._oid = VP._provider_oid
					WHERE _rct_vacancy._oid= '".$_REQUEST['oid']."' 
				</query>-->

				<fields mode="edit_default">	
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" isRequired = "true"/>
					<field name="number" label="number" type="integer" default="1" />
					<field name="email" label="email" type="email" />
					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer"/>

					<!--Le créateur du dossier-->
					<!--<field name="creator" label="creator" type="ref-oid" sqlType="integer" show="hidden"/>	-->
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<!--<field name="contract_type_oid" label="contract_type_oid" type="text-choice" control="radio" controlLayout="table"  columns="4"  multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />-->
					<field name="evaluation_criteria" label="evaluation_criteria" type="text-choice" ds="db:rct_interview_default_criteria.ds_list@recruitment" control="checkbox" ds_format="{field:name}" ds_field_value="oid" sqlType="varchar(255)" prompt="select criteria ..." multiple="true" controlLayout="table" columns="3"/>
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice" control="select"  multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="mission_start_date" label="mission_start_date" type="date" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />
					<field name="taking_office_date" label="taking_office_date" type="date" />
					<field name="code" label="code" type="line" />
					<field name="archive_state" type="text-choice" list="recruitment.archive_state" control="select" sqlType="integer"/>
					<field name="announce_date" label="announce_date" type="date"/>
					<field name="closing_announce_date" label="closing_announce_date" type="date" />
					<!--<field name="date" label="date" type="date" format="%d/%m/%Y" value="now" />
					<field name="active" label="active" type="boolean"  />-->

					<field 
						name			= "creator"
						label			= "creator" 
						type			= "text-choice" 
						prompt			= "creator..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"		
						ds_field_value="oid" sqlType="integer"
						isEdit			= "false"/>
						
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"		
						ds_field_value="oid" sqlType="integer"/>
						
					<field 
						name			= "rh_oid"
						label			= "manager_oid" 
						type			= "line" 
						is_transient	= "true"  
						isEdit			= "false"/>	

					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						ds_field_value	= "oid" />
						
					<field 
						name			= "sector_oid"
						label			= "sector_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "sector_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:rct_job_sector.list@recruitment3"
						ds_link			= "rct_vacancy_sector"
						ds_format		= "{field:name}"
						ds_field_value	= "oid" />
					<field name="vacancy_success" label="vacancy_success" type="text-choice" list="recruitment.vacancy_success" control="select" sqlType="integer" />
					

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
					<field name="progress_level" label="progress_level"  type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" isEdit="no" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />
					<!--<field name="provider_oid" label="provider_oid" type="text-choice" control="select" multiple="false" ds="db:rct_provider.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />-->

					<!--<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />-->

					<field name="closing_date" label="closing_date" type="date" />

					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					
					<field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					
					<field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
					
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />

					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />
					
					<field name="application_type" label="application_type" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" prompt="select application type ..." multiple="true"/>

					<field name="opening_date" label="opening_date" type="date" isEdit="no" />
					<field name="delay_between_open_and_close" label="delay_between_open_and_close" type="expression" field="progress_level" key="oid" control_html="count_days" date1="opening_date" date2="closing_date" />
					<field name="delay_between_close_and_taking_office" label="delay_between_close_and_taking_office" type="expression" field="progress_level" key="oid" control_html="count_days" date1="closing_date" date2="taking_office_date" />
					
					<!--droit de consultation du dossier -->
					
					<field name="groups_user_readonly" label="groups_user_readonly" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator@recruitment" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_readonly" ds_field_value="oid" />
					
					<!--controle total du dossier -->
					
					<field name="groups_user_total_control" label="groups_user_total_control" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator@recruitment" ds_link="rct_vacancy_total_control" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
					
					<field name="internship_title" label="internship_title" type="line" />
					<field name="internship_start" label="internship_start" type="date" />
					<field name="internship_end" label="internship_end" type="date" />
					<field name="executive_committee_presentation" label="executive_committee_presentation" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<!--<field name="delay_between_open_and_close" label="delay_between_open_and_close" type="expression" control_html="count_days" date1="opening_date" date2="closing_date" />
					<field name="delay_between_close_and_taking_office" label="delay_between_close_and_taking_office" type="expression" control_html="count_days" date1="closing_date" date2="taking_office_date" />-->

                    <field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
                    <field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <!--<field name="duty_station_oid" label="duty_station_oid" type="line" />-->
                    <field name="work_schedule" label="work_schedule" type="line" />

                    <field name="years_of_practice" label="years_of_practice" type="integer" />
                    <!--<field name="years_of_practice_max"  type="integer" />-->

                    <field name="suited_diplomas" label="suited_diplomas" type="line" />
                    <field name="companies_having_same_profile" label="companies_having_same_profile" type="line" />
                    <field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." />

                    <field name="technical_qualifications" label="technical_qualifications" type="rich-text"/>
                    <field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text"/>

                    <!--<field name="mission_definitions" label="mission_definitions" type="text" multiLines="auto" size="255" />-->
                    <field name="organisme_definitions" label="organisme_definitions" type="rich-text" />
                    <field name="mission_definitions" label="mission_definitions" type="rich-text" />

                    <field name="mission_means" label="mission_means" type="rich-text" />
					<field name="descriptionProfil" label="descriptionProfil" type="rich-text" csslayout="normal-layout" />
					<!-- project -->
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.all_list@recruitment" ds_format="{field:name}"  default = "0" ds_field_value="oid" sqlType="integer" />
					<!-- connected application -->
					<field name="app_connected" label="app_connected" type="text-choice" ds="db:app_connected.list@recruitment" control="checkbox" multiple="true" ds_format="{field:name}"  ds_field_value="oid" sqlType="integer" />
					<field name="salary_min" label="salary_marge" type="line" size="15" prompt="Min"/>
					<field name ="salary_max" label ="salary_max" type ="line" size="15" prompt="Max"/>
					<field name ="salary_type" label ="salary_type" type="text-choice" list="recruitment.salary_type" control="select" sqlType="integer" size="15" />
					<field name="type_ao" label="type_ao" type="text-choice" list="recruitment.type_ao" control="select" sqlType="integer" />
					
					<field 
						name		= "offers_list" 
						label		= "offers_list" 
						type		= "records" 
						ds			= "db:rct_vacancy_provider.list"
						ds_record	= "db:rct_vacancy_provider.record"
						key			= "oid"
						fkey		= "vacancy_oid"
						view		= "recruitment.vacancies.components.offer"
						edit_view	= "recruitment.vacancies.components.offer"
					/>
				</fields>

				
				<key mode="edit_readonly_default">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</key>

				<fields mode="edit_readonly_default">	
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" isEdit = "no"/>
					<field name="number" label="number" type="integer" isEdit = "no" default="1"/>	
					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer" isEdit = "no"/>

					<!--Le créateur du dossier-->
				
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isEdit = "no" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isEdit = "no" />
					<field name="mission_start_date" label="mission_start_date" type="date" isEdit = "no" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" isEdit = "no" />
					<field name="taking_office_date" label="taking_office_date" type="date" isEdit = "no" />
					<field name="code" label="code" type="line" isEdit = "no" />
					<field name="archive_state" label="archive_state" type="text-choice" list="recruitment.archive_state" control="select" sqlType="integer" isEdit = "no" />

					<field 
						name			= "creator"
						label			= "creator" 
						type			= "text-choice" 
						prompt			= "creator..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"		
						ds_field_value="oid" sqlType="integer"
						isEdit			= "false" isEdit = "no"/>
						
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"		
						ds_field_value="oid" sqlType="integer" isEdit = "no"/>

					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						ds_field_value	= "oid" isEdit = "no" />

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" isEdit = "no" />
					<field name="progress_level" label="progress_level"  type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" isEdit="no" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" isEdit="no" />

					<field name="closing_date" label="closing_date" type="date" isEdit="no"  />

					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." isEdit="no" />
					
					<field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." isEdit="no"  />
					
					<field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." isEdit="no"  />
					
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." isEdit="no"  />
					
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" isEdit="no"  />

					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." isEdit="no"  />
					
					<field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" prompt="select application type ..." multiple="true" isEdit="no" />

					<field name="opening_date" label="opening_date" type="date" isEdit="no" />
					<field name="delay_between_open_and_close" label="delay_between_open_and_close" type="expression" field="progress_level" key="oid" control_html="count_days" date1="opening_date" date2="closing_date" isEdit="no"  />
					<field name="delay_between_close_and_taking_office" label="delay_between_close_and_taking_office" type="expression" field="progress_level" key="oid" control_html="count_days" date1="closing_date" date2="taking_office_date" isEdit="no"  />
					
					<!--droit de consultation du dossier -->
					
					<field name="groups_user_readonly" label="groups_user_readonly" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator@recruitment" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_readonly" ds_field_value="oid" isEdit="no" />
					
					<!--controle total du dossier -->
					
					<field name="groups_user_total_control" label="groups_user_total_control" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator@recruitment" ds_link="rct_vacancy_total_control" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" isEdit="no" />
					
					<field name="internship_title" label="internship_title" type="line" isEdit="no" />
					<field name="internship_start" label="internship_start" type="date" isEdit="no" />
					<field name="internship_end" label="internship_end" type="date" isEdit="no" />
					<field name="executive_committee_presentation" label="executive_committee_presentation" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" isEdit="no" />

                    <field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isEdit="no" />
                    <field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" isEdit="no"  />
                    <field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isEdit="no"  />
                    <field name="duty_station_oid" label="duty_station_oid" type="line" isEdit="no"  />
                    <field name="work_schedule" label="work_schedule" type="line" isEdit="no"  />

                    <field name="years_of_practice" label="years_of_practice" type="integer" isEdit="no"  />
                    <field name="years_of_practice_max"  type="integer" isEdit="no"  />

                    <field name="suited_diplomas" label="suited_diplomas" type="line" isEdit="no"  />
                    <field name="companies_having_same_profile" label="companies_having_same_profile" type="line" isEdit="no" />
                    <field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." isEdit="no"  />

                    <field name="technical_qualifications" label="technical_qualifications" type="rich-text" isEdit="no" />
                    <field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text" isEdit="no" />

                    <field name="mission_definitions" label="mission_definitions" type="rich-text" isEdit="no" />
                    <field name="organisme_definitions" label="organisme_definitions" type="rich-text" isEdit="no" />
					<!-- project -->
					<field name ="vacancy_project" label="vacancy_project" type="text-choice" control="select" multiple="false" ds="db:vacancy_project.all_list@recruitment" ds_format="{field:name}"  default = "0" ds_field_value="oid" sqlType="integer" isEdit="no" />
					<!-- connected application -->
					<field name="app_connected" label="app_connected" type="text-choice" ds="db:app_connected.list@recruitment" control="checkbox" multiple="true" ds_format="{field:name}"  ds_field_value="oid" sqlType="integer" isEdit="no" />
					<field name="announce_date" label="announce_date" type="date" isEdit="no"/>
					<field name="closing_announce_date" label="closing_announce_date" type="date" isEdit="no"/>
                    <field name="mission_means" label="mission_means" type="rich-text" isEdit="no"  />
					<field name="salary_min" label="salary_min" type="line" isEdit="no"  />
					<field name ="salary_max" label ="salary_max" type ="line" isEdit="no"  />
					<field name ="salary_type" label ="salary_type" type="text-choice" list="recruitment.salary_type" control="select" sqlType="integer" isEdit="no" />
				</fields>
				
				<query mode="get_vacancies_by_provider" type="select">
					SELECT 	_rct_vacancy._oid,_rct_vacancy._name , _rct_vacancy._email , _rct_vacancy._code , VP._oid AS _vp_oid , VP._ref , VP._offer_name , VP._index, VP._id_index
					FROM _rct_vacancy 
					LEFT JOIN _rct_vacancy_provider as VP ON VP._vacancy_oid = _rct_vacancy._oid
					WHERE VP._provider_oid= '".$props->getProperty("provider_oid")."' 
				</query>
				<fields mode="get_vacancies_by_provider">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="vp_oid" label="vp_oid" type="ref-oid" sqlType="integer" show="hidden"/>	
					<field name="email" label="email" type="email" />
					<field name="code" label="code" type="line" />
					<field name="name" label="name" type="line" />
					<field name="ref" label="ref" type="line"/>	
					<field name="id_index" label="id_index"  type="line" size="200" show="hidden" />
					<field name="index" label="index" type="integer" show="hidden" />
					<field name="offer_name" label="offer_name" type="line"/>	
				</fields>
				
				<key mode="vacancy_title">
					<field name="oid" label="oid" type="oid" isKey="primary" value="%{request:vacancy_oid}" />
				</key>
				<fields mode="vacancy_title">
					<field name="name" label="name" type="line" />
					<field name="code" label="code" type="line" />

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
				</fields>
				
				<!-- lydec edition -->
				
				<key mode="edit_lydec">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					
				</key>

				<fields mode="edit_lydec">	
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="name" label="name" type="line" />
					<field name="number" label="number" type="integer" default="1" value="1"/>	
					<field 
						name			= "cand_channel"
						label			= "cand_channel" 
						type			= "text-choice" 
						prompt			= "cand_channel..."
						multiple		= "false"
						control			= "select"
						ds				= "db:rct_channel.ds_list@recruitment"
						ds_format		= "{field:name}" 
						ds_field_value="oid" sqlType="integer"/>

					<!--Le créateur du dossier-->
					<field name="creator" label="creator" type="ref-oid" sqlType="integer" show="hidden" isEdit="false"/>	
					
					<field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="contract_type_oid" label="contract_type_oid" type="text-choice" control="radio" controlLayout="table"  columns="4"  multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="mission_start_date" label="mission_start_date" type="date" />
					<field name="suited_recruitment_date" label="suited_recruitment_date" type="date" />
					<field name="taking_office_date" label="taking_office_date" type="date" />
					<field name="code" label="code" type="line" />
					<field name="archive_state" label="archive_state" type="text-choice" list="recruitment.archive_state" control="select" sqlType="integer" />
					<field 
						name			= "manager_oid"
						label			= "manager_oid" 
						type			= "text-choice" 
						prompt			= "manager_oid..."
						multiple		= "false"
						control			= "select"
						ds				= "db:user.ds_list_all@recruitment"
						ds_format		= "{field:first_name} {field:last_name}"					
						ds_field_value="oid" sqlType="integer"/>

					<field 
						name			= "client_oid"
						label			= "client_oid" 
						type			= "text-choice-table" 
						list			= "product_range"
						prompt			= "client_oid..."
						multiple		= "yes"
						control			= "facebook_list"
						ds				= "db:user.ds_list_all@recruitment"
						ds_link			= "rct_vacancy_client"
						ds_format		= "{field:first_name} {field:last_name}"
						ds_field_value	= "oid" />

					<field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" 
						sqlType="integer" />
					<field name="progress_level" label="progress_level"  type="text-choice" list="recruitment.vacancy_progress_level" control="select" 
						sqlType="integer" isEdit="no" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" 
						control_html="progress_level" />

					<!--<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />-->

					<field name="closing_date" label="closing_date" type="date" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false"	
						ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					<field name="direction" label="direction" type="text-choice" control="select" multiple="false" ds="db:directions" 
						ds_format="{field:group_name}" ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					<field name="pole" label="pole" type="text-choice" control="select" multiple="false" ds="db:poles" ds_format="{field:group_name}" 
						ds_field_value="oid" sqlType="integer" prompt="direction ..." />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list"	
						ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="service_oid..." />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" 
						ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="subsidiary_oid..." />
					<field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" 
						sqlType="char(6)" prompt="select application type ..." multiple="true"/>

					<field name="opening_date" label="opening_date" type="date" isEdit="no" />
					<field name="delay_between_open_and_close" label="delay_between_open_and_close" type="expression" field="progress_level" key="oid" 
						control_html="count_days" date1="opening_date" date2="closing_date" />
					<field name="delay_between_close_and_taking_office" label="delay_between_close_and_taking_office" type="expression" 
						field="progress_level" key="oid" control_html="count_days" date1="closing_date" date2="taking_office_date" />
					
					<!--droit de consultation du dossier -->
					
					<field name="groups_user_readonly" label="groups_user_readonly" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator@recruitment" ds_format="{field:first_name} {field:last_name}" ds_link="rct_vacancy_readonly" ds_field_value="oid" />
					
					<!--controle total du dossier -->
					
					<field name="groups_user_total_control" label="groups_user_total_control" type="text-choice-table" prompt="Tous ..." multiple="true" control="lists_filter" columns="2" ds="db:user.ds_list_without_creator@recruitment" ds_link="rct_vacancy_total_control" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />

					
					<field name="internship_title" label="internship_title" type="line" />
					<field name="internship_start" label="internship_start" type="date" />
					<field name="internship_end" label="internship_end" type="date" />
					<field name="executive_committee_presentation" label="executive_committee_presentation" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<!--<field name="delay_between_open_and_close" label="delay_between_open_and_close" type="expression" control_html="count_days" date1="opening_date" date2="closing_date" />
					<field name="delay_between_close_and_taking_office" label="delay_between_close_and_taking_office" type="expression" control_html="count_days" date1="closing_date" date2="taking_office_date" />-->


				<!-- lydec -->

					<field name="budget_O_N" label="budget_O_N" type="text-choice" list="recruitment.budget" control="radio" sqlType="integer" />
					<field name ="budget" label ="budget" type ="line" />
					<field name ="csp" label="csp" type="text-choice" control="select" multiple="false" ds="db:directory_csp@admin" ds_format="{field:csp_name}"  ds_field_value="oid" sqlType="integer" />
					<field name="cc" label="cc" type="line" />
					<field name="version" label="version" type="line" />
					<field name="Cout" label="cout" type="line" />
				</fields>			

				<key mode="edit_fib">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</key>

				<fields mode="edit_fib">	
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
					<field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					<field name="duty_station_oid" label="duty_station_oid" type="line" />
					<field name="work_schedule" label="work_schedule" type="line" />

					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="years_of_practice_max"  type="integer" />

					<field name="suited_diplomas" label="suited_diplomas" type="line" />
					<field name="companies_having_same_profile" label="companies_having_same_profile" type="line" />
					<field name="recruitment_reasons" label="recruitment_reasons" type="text-choice" control="select" multiple="false" ds="db:rct_recruitment_reason.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="recruitment_reasons..." />

					<field name="technical_qualifications" label="technical_qualifications" type="rich-text"/>
					<field name="behavioral_qualifications" label="behavioral_qualifications" type="rich-text"/>

					<!--<field name="mission_definitions" label="mission_definitions" type="text" multiLines="auto" size="255" />-->
					<field name="mission_definitions" label="mission_definitions" type="rich-text" />
					<field name="organisme_definitions" label="organisme_definitions" type="rich-text" />

					<field name="mission_means" label="mission_means" type="rich-text" />
				</fields>


				<!-- DML servant &amp;agrave; récupérer le niveau de progression actuel du dossier, utilisé pour alimenter le log -->
				<key mode="get_current_progress_level">
					<field name="oid" label="oid" type="oid" isKey="primary" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="get_current_progress_level">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />

				</fields>

			</table>


			<!-- Table associative pour les utilisateurs qui ont le droit de consultation)-->	
	
			<table name="rct_vacancy_readonly">
				<key>
					<field name="key"  type="ref-oid" value="%{property:key}"/>
				</key>	
				<key mode="permission">
					<field name="key" type="ref-oid" relation="EQ" value="%{property:vacancy_id}"  />
					<field name="val" type="ref-oid" relation="EQ" value="%{user:oid}"  />
				</key>
				<key mode="delete_by_poste">
					<field name="key" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="delete_by_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="key"  type="ref-oid" />
					<field name="val"  type="ref-oid" />
				</fields>
			</table>
			<!-- Table associative pour les utilisateurs qui ont le control total sur le dossier)-->	
			
			<table name="rct_vacancy_total_control">
				<key>
					<field name="key"  type="ref-oid" value="%{property:key}"/>
				</key>	
				<key mode="permission">
					<field name="key" type="ref-oid" relation="EQ" value="%{property:vacancy_id}"  />
					<field name="val" type="ref-oid" relation="EQ" value="%{user:oid}"  />
				</key>
				<key mode="delete_by_poste">
					<field name="key" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="delete_by_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="key"  type="ref-oid" />
					<field name="val"  type="ref-oid" />
				</fields>
			</table>

		<!-- 

			Actions sur le dossier (actions)

		-->		
			<table name="rct_vacancy_action">
				<key mode="record">
					<field name="oid" type="oid" />
				</key>
				
				<key mode="delete_by_poste">
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="delete_by_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>

				<key mode="ds_list">
				</key>

				<key mode="by_vacancy_oid">
					<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}"  />
				</key>

				<sort mode="by_vacancy_oid">
					<field name="date" label="date" type="timestamp" direction="desc" />
				</sort>			

				<fields>

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" is_edit="no" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />		

					<field name="user_oid" label="user_oid" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
					<field name="date" label="date" type="timestamp" value="now" format="%d/%m/%Y &amp;agrave; %H:%M" />
					<field name="action_oid" label="action_oid" type="text-choice" list="recruitment.vacancy_action@recruitment" control="select" sqlType="integer" />
					<field name="ref_oid" label="ref_oid" type="ref-oid" sqlType="integer" />
					<field name="additional_infos" label="additional_infos" type="line" />

				</fields>

			</table>

			

		<!-- 

			Fichiers attachés au dossier

		-->
			<table name="rct_vacancy_attached_file">
				<key mode="record">
					<field name="oid" type="oid" />
				</key>

				<!-- Utilisé dans le Handler pour charger le nom du fichier et pour supprimer -->
				<key mode="get_record">
					<field name="oid" type="oid" relation="EQ" value="%{property:oid}" />
				</key>
				
				<key mode="delete_by_poste">
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="delete_by_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>

				<key mode="by_vacancy">
					<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}" />
				</key>			

				<fields mode="add_record">
					<field name="vacancy_oid" type="ref-oid" value="%{property:object_oid}" />
					<field name="file_name" type="line" value="%{property:file_name}" />
				</fields>
				

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="file_name" label="file_name" type="file" />
				</fields>
			</table>

		<!-- 

			Commentaires

		-->
			<table name="rct_vacancy_comment">
				<key mode="record">
					<field name="oid" type="oid" />
				</key>
				<key mode="delete_by_poste">
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="delete_by_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>

				<key mode="get_record">
					<field name="oid" type="oid" relation="EQ" value="%{property:comment_oid}" />
				</key>

				<key mode="ds_list">
					<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<sort mode="ds_list">
					<field name="date" type="timestamp" direction="ASC" />
				</sort>			

				<key mode="add">
					<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="add">
					<field name="vacancy_oid" type="ref-oid" value="%{request:oid}" />
					<field name="user_oid" type="ref-oid" value="%{user:oid}" />
					<field name="date" type="timestamp" value="now" />
					<field name="comment" type="text" />
				</fields>

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />				

					<field name="user_oid" label="user_oid" type="text-choice" control="select" multiple="false" ds="db:user.ds_list_all@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" sqlType="integer" />					

					<field name="date" label="date" type="timestamp" format="Le %d %B %Y &amp;agrave; %H:%M" />
					<field name="comment" label="comment" type="text" />
				</fields>
			</table>

		<!--

			Commentaires liés au candidat

		-->

		<table name="rct_candidate_vacancy_comment">

			<key mode="record">
				<field name="oid" type="oid" />
			</key>

			<key mode="get_record">
				<field name="oid" type="oid" relation="EQ" value="%{property:comment_oid}" />
			</key>

			<key mode="ds_list">
				<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}" />
				<field name="candidate_oid" type="ref-oid" value="%{property:oid|0}"/>
			</key>

			<sort mode="ds_list">
				<field name="date" type="timestamp" direction="ASC" />
			</sort>			

			<key mode="add">
				<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}" />
			</key>

			<fields mode="add">

				<field name="vacancy_oid" type="ref-oid" value="%{property:vacancy_oid}" />
				<field name="candidate_oid" type="ref-oid" value="%{property:candidate_oid}" />
				<field name="user_oid" type="ref-oid" value="%{user:oid}" />
				<field name="date" type="timestamp" value="now" />
				<field name="comment" type="text" />

			</fields>

			<fields>

				<field name="oid" label="oid" type="oid" isKey="primary" />
				<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
				<field name="candidate_oid" label="candidate_oid" type="ref-oid" isKey="secondary" sqlType="integer" />	
				<field name="user_oid" label="user_oid" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" sqlType="integer" />					

				<field name="date" label="date" type="timestamp" format="Le %d %B %Y &amp;agrave; %H:%M" />
				<field name="comment" label="comment" type="text" />

			</fields>

		</table>
			

		<!-- 

			Association candidats / dossiers

		-->		
			<table name="rct_candidate_vacancy">
				<!-- 
					Liste des dossiers associés &amp;agrave; un candidat
				-->
				<key mode="candidate_vacancies">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
				</key>
				

				<fields mode="candidate_vacancies">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" isProp="key" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="vacancy_oid" label="vacancy_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy.ds_list" ds_format="{field:name} (N° {field:code})" ds_field_value="oid" sqlType="integer" />
				</fields>

                <query mode="candidates_vacancies_list" type="select">
                    SELECT
                       _rct_vacancy._oid as _oid,
                       _rct_vacancy._manager_oid as _manager_oid,
                       _rct_vacancy._name as _name,
                       _rct_vacancy._number as _number,
                       _rct_candidate_vacancy._etat_oid as _etat_oid,
                       _rct_vacancy._code as _code,
                       _rct_vacancy._manager_oid as _manager_oid,
                       _rct_vacancy._contract_type_oid as _contract_type_oid,
                       _rct_vacancy._subsidiary_oid as _subsidiary_oid,
                       _rct_vacancy._service_oid as _service_oid,
                       _rct_vacancy._duty_station_oid as _duty_station_oid,
                       _rct_vacancy._establishment as _establishment,
                       _rct_vacancy._current_step as _current_step,
                       _rct_vacancy._progress_level as _progress_level,
                       _rct_vacancy._application_type as _application_type,
                       _rct_vacancy._opening_date as _opening_date,
                       _rct_vacancy._closing_date as _closing_date,
                       _rct_candidate_vacancy._candidate_oid as _candidate_oid,
                       _rct_candidate_vacancy._job_acceptance_state as _job_acceptance_state,
                       _rct_candidate_vacancy._status as _status,
					   _rct_candidate_vacancy._oid as _assoc_oid,
					   _rct_candidate_vacancy._cv_source_oid as _cv_source_oid,
	
					   COALESCE(_rct_candidate_vacancy._ci_acceptance_state, 0) as _ci_acceptance_state,
					   COALESCE(_rct_candidate_vacancy._job_acceptance_state, 0) as _job_acceptance_state,
					   COALESCE(_rct_candidate_vacancy._proposal_acceptance_state, 0) as _proposal_acceptance_state,
					   _rct_candidate_vacancy._proposal_acceptance_date AS _proposal_acceptance_date,
	
					   COALESCE(_rct_candidate_vacancy._status, 0) as _status,
					   COALESCE(_rct_candidate_vacancy._rating, 0) as _rating,
					   COALESCE(_rct_candidate_vacancy._is_visible, 0) as _is_visible


                    FROM
                        _rct_vacancy

                    LEFT JOIN

                        _rct_candidate_vacancy ON _rct_candidate_vacancy._vacancy_oid = _rct_vacancy._oid

                    LEFT JOIN
                        _rct_candidate ON _rct_candidate._oid = _rct_candidate_vacancy._candidate_oid

                    WHERE
                        _rct_candidate_vacancy._candidate_oid = '".$props->getProperty("candidate_oid")."'

                    ORDER BY _name ASC
                </query>
                <fields mode="candidates_vacancies_list">
                    <field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="hidden" />
                    <!--<field table="rct_vacancy_readonly" name="key" alias= "key_readonly" type="ref-oid" />
                    <field table="rct_vacancy_total_control" name="key" alias= "key_total_control" type="ref-oid" />-->
                    <field
                        name			= "manager_oid"
                        label			= "manager_oid"
                        type			= "text-choice"
                        prompt			= "manager_oid..."
                        multiple		= "false"
                        control			= "select"
                        ds				= "db:user.ds_list_all@recruitment"
                        ds_format		= "{field:first_name} {field:last_name}"
                        ds_field_value="oid" sqlType="integer"/>

                    <field name="candidate_oid" label="candidate_oid" type="line" sqlType="integer" />

                    <!-- Colonne 1 -->
                    <field name="name" alias="name"  label="name" type="line" />
                    <field name="number" label="number" type="integer" default="1" value="1"/>
					<field name="etat_oid" label="etat_oid" type="text-choice" control="select" multiple="false" ds="db:rct_candidate_etat.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isKey=""/>

                    <field name="code" label="code" type="line" />
                    <field name="category_oid" label="category_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy_category.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <field name="contract_type_oid" label="contract_type_oid" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

                    <!-- Colonne 2 -->
                    <field name="subsidiary_oid" label="subsidiary_oid" type="text-choice" control="select" multiple="false" ds="db:rct_subsidiary.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <field name="establishment" label="establishment"  multiLines="no" type="text-choice" multiple="false" control="select" ds="entities.my_entities.ds_list@admin2" ds_format="{field:entity_name}" ds_field_value="oid" isKey="secondary" />
                    <field name="service_oid" label="service_oid" type="text-choice" control="select" multiple="false" ds="db:rct_service.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
                    <field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />

                    <!-- Colonne 3 -->
                    <field name="current_step" label="current_step" type="text-choice" list="recruitment.vacancy_step" control="select" sqlType="integer" />
                    <field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level" control="select" sqlType="integer" />
                    <field name="progress_level_meta" label="progress_level_meta" type="expression" field="progress_level" key="oid" control_html="progress_level" />

                    <field name="application_type" label="current_step" type="text-choice" list="recruitment.application_type" control="checkbox" sqlType="char(6)" multiple="true"/>
                    <field name="candidates_count" label="candidates_count" type="integer" is_transient="true" />

                    <!-- Colonne 4 -->
                    <field name="opening_date" label="opening_date" type="timestamp" format="%d %B %Y" />
                    <field name="closing_date" label="closing_date" type="timestamp" format="%d %B %Y" />

                    <!--Le créateur du dossier-->
                    <field name="creator" label="creator" type="line" sqlType="integer" />

                    <field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
                    <field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					
					<!--history-->
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c_oid"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c_oid"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
					<field name="cv_source_oid" label="provider_oid" type="text-choice" control="select" multiple="false" ds="db:rct_provider.ds_list" ds_format="{field:name}" prompt="select provider ..." ds_field_value="oid" sqlType="integer" />
                </fields>
				

				<key mode="candidate_vacancies_c">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:oid}" />
				</key>
				<fields mode="candidate_vacancies_c">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="vacancy_oid" label="vacancy_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy.ds_list" ds_format="{field:name} (N° {field:code})" ds_field_value="oid" sqlType="integer" />
				</fields>
				
				<key mode="candidate_vacancies_c_oid">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
				</key>
				<fields mode="candidate_vacancies_c_oid">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="vacancy_oid" label="vacancy_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy.ds_list" ds_format="{field:name} (N° {field:code})" ds_field_value="oid" sqlType="integer" />
				</fields>
				
				<!-- 
					Liste des candidats associés &amp;agrave; un dossier
				-->
				<key mode="vacancy_candidates">
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_id}" />
				</key>
				<query mode="vacancy_candidates_not_null" type="select">
                    /*SELECT
                        _rct_candidate._oid as _candidate_oid,
                        _rct_candidate_vacancy._oid as _oid
                    FROM

                        (select _oid from _rct_candidate group by _first_name , _last_name , _email) _rct_candidate
                        LEFT JOIN _rct_candidate_vacancy ON _rct_candidate._oid = _rct_candidate_vacancy._candidate_oid
                    WHERE
                        _rct_candidate_vacancy._vacancy_oid = '".$_REQUEST['vacancy_id']."'
                        AND _rct_candidate._oid IS NOT NULL */
                        
                    SELECT _rct_candidate._oid as _candidate_oid , _rct_vacancy._oid as _oid
					FROM _rct_candidate
					LEFT JOIN _rct_candidate_vacancy ON _rct_candidate_vacancy ._candidate_oid = _rct_candidate._oid
					LEFT JOIN _rct_vacancy ON _rct_candidate_vacancy._vacancy_oid = _rct_vacancy._oid
					WHERE _rct_vacancy._oid = '".$_REQUEST['vacancy_id']."' 
					GROUP BY _rct_candidate._oid
					/*GROUP BY _rct_candidate._first_name, _rct_candidate._last_name, _rct_candidate._email*/
                        
                </query>
                <fields mode="vacancy_candidates_not_null">
                    <field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
                    <field name="candidate_oid" label="candidate_oid" type="text-choice" />
                </fields>
				<fields mode="vacancy_candidates">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="text-choice" />
				</fields>
				<query mode="get_last_vacancy_for_candidate" type="select">   
                    SELECT _rct_candidate_vacancy._vacancy_oid as _vacancy_oid
					FROM _rct_candidate_vacancy Left Join _rct_vacancy ON _rct_candidate_vacancy._vacancy_oid = _rct_vacancy._oid
					WHERE _rct_candidate_vacancy._candidate_oid = '".$props->getProperty("candidate_oid")."' 
					AND _rct_vacancy._current_step = 0
					AND `_add_date` = (
						SELECT MAX(`_add_date`)
						FROM _rct_candidate_vacancy
						WHERE _rct_candidate_vacancy._candidate_oid ='".$props->getProperty("candidate_oid")."' 
					)    
                </query>
				<fields mode="get_last_vacancy_for_candidate">
                    <field name="vacancy_oid" label="vacancy_oid" type="text-choice" />
                </fields>

				<key mode="change_hire_date">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:assoc_oid}" />

				</key>

				<fields mode="change_hire_date">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="hire_date" label="hire_date" type="date" />

				</fields>			

				<key mode="change_contrat_signing">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:assoc_oid}" />

				</key>

				<fields mode="change_contrat_signing">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="contrat_signing" label="contrat_signing" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" prompt="select contrat_signing..." />

				</fields>

				

				<key mode="change_integration_plan">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:assoc_oid}" />

				</key>

				<fields mode="change_integration_plan">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="integration_plan" label="integration_plan" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" prompt="select integration_plan..." />

				</fields>

				

				<key mode="change_integration_note">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:assoc_oid}" />

				</key>

				<fields mode="change_integration_note">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="integration_note" label="integration_note" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" prompt="select integration_note..." />

				</fields>

				<query mode="selected_candidates" type="select">

					SELECT

						_rct_candidate_vacancy._oid as _oid,
						_rct_candidate_vacancy._vacancy_oid as _vacancy_oid,
						COALESCE(_rct_candidate_vacancy._contrat_signing,0) as _contrat_signing,
						COALESCE(_rct_candidate_vacancy._integration_plan,0) as _integration_plan,
						COALESCE(_rct_candidate_vacancy._integration_note,0) as _integration_note,
						_rct_candidate_vacancy._hire_date as _hire_date,
						_rct_candidate_vacancy._hire_date as _hire_date_raw,
						CONCAT_WS(' ', _rct_candidate._first_name,_rct_candidate._last_name) as _full_name

					FROM 
						_rct_candidate_vacancy

					LEFT JOIN 
						_rct_candidate ON _rct_candidate._oid = _rct_candidate_vacancy._candidate_oid

					WHERE 
						_rct_candidate_vacancy._vacancy_oid = '".$this->getProperty("vacancy_oid")."'
						

					AND 
						_rct_candidate_vacancy._job_acceptance_state = '1'

					ORDER BY _full_name ASC

				</query>

				<fields mode="selected_candidates">

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="vacancy_oid" type="ref-oid" isKey="secondary" />
					<field name="assoc_oid" label="assoc_oid" type="expression" value="{field.object:oid}" isKey="secondary" />	

					<field name="full_name" label="full_name" type="line" is_transient="true" />
					<field name="contrat_signing" label="contrat_signing" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					

					<field name="integration_plan" label="integration_plan" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					

					<field name="integration_note" label="integration_note" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<field name="hire_date" label="hire_date" type="date" format="%d %B %Y" />	
					<field name="hire_date_raw" label="hire_date_raw" type="line" is_transient="true" />
				</fields>			

				<query mode="accepted_proposals" type="select">

					SELECT
						_rct_candidate_vacancy._proposal_acceptance_date, CONCAT_WS(' ', _rct_candidate._first_name,_rct_candidate._last_name) as _full_name

					FROM 
						_rct_candidate_vacancy

					LEFT JOIN 
						_rct_candidate ON _rct_candidate._oid = _rct_candidate_vacancy._candidate_oid

					WHERE 
						_rct_candidate_vacancy._vacancy_oid = '".$this->getProperty("vacancy_oid")."' 

					AND 
						_rct_candidate_vacancy._proposal_acceptance_state = '1' 

					AND 
						_rct_candidate_vacancy._proposal_acceptance_date IS NOT NULL

					ORDER BY 

						_rct_candidate_vacancy._proposal_acceptance_date DESC					

				</query>

				<fields mode="accepted_proposals">

					<field name="full_name" label="full_name" type="line" is_transient="true" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />

				</fields>

				<!--<key mode="handle_proposal">

					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />

				</key>-->
				<fields mode="handle_proposal">
					<field name="date" is_transient="true" type="date" />
				</fields>
				
				<!-- 
					Association précise candidat / Dossier
				-->
				<key mode="get_assoc">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>
				<fields mode="get_assoc">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" isProp="key" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="vacancy_oid" label="vacancy_oid" type="text-choice" control="select" multiple="false" ds="db:rct_vacancy.ds_list" ds_format="{field:name} (N° {field:code})" ds_field_value="oid" sqlType="integer" />
				</fields>

				<fields mode="add_assoc">
					<field name="candidate_oid" label="candidate_oid" type="ref-oid" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid"  value="%{property:vacancy_oid}" />
					<field name="add_date" label="add_date" type="timestamp" value="now" />
				</fields>

				<key mode="rate">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="rate">
					<field name="rating" type="ref-oid" value="%{property:rating_value}" />
				</fields>

				<key mode="change_status">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="change_status">
					<field name="status" type="ref-oid" value="%{property:status_value}" />
				</fields>
		

				<!-- Changement d'état + ajout de la date dans le cas de l'acceptation ou du refus d'une proposition -->

				<key mode="change_proposal_status">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="change_proposal_status">
					<field name="status" type="ref-oid" value="%{property:status_value}" />
					<field name="proposal_acceptance_date" type="date" value="%{property:rawdate}" />
					<field name="proposal_acceptance_state" type="integer" value="%{property:proposal_acceptance_state}" />

				</fields>

				<key mode="unlink_candidate">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="unlink_candidate">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				
				<key mode="unlink_from_all">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
				</key>

				<fields mode="unlink_from_all">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>
				
				<key mode="unlink_candidate_poste">
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="unlink_candidate_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>

				<key mode="send_to_ic">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="send_to_ic">
					<field name="is_visible" type="integer" value="%{property:visibility}" />
				</fields>

				<!--

					Changements d'état

				-->

				<key mode="change_ci_acceptance">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="change_ci_acceptance">
					<field name="ci_acceptance_state" type="integer" value="%{property:acceptance_status}" />
					<field name="ci_acceptance_date" type="timestamp" value="now" />
				</fields>

				<key mode="change_job_acceptance">
					<field name="candidate_oid" type="integer" relation="EQ-MATCH" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="change_job_acceptance">
					<field name="job_acceptance_state" type="integer" value="%{property:acceptance_status}" />
					<field name="job_acceptance_date" type="timestamp" value="now" />
				</fields>

				<!-- Update cv_source_oid // provider -->
				<key mode="update_provider">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>

				<fields mode="update_provider">
					<field name="cv_source_oid" label="cv_source_oid" type="ref-oid" value="%{property:provider_oid}" />
				</fields>	

				<key mode="edit_integration_date">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>
				<fields mode="edit_integration_date">
					<field name="candidate_oid" label="candidate_oid" type="text-choice" value="%{property:candidate_oid}" show="hidden" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" show="hidden" />
					<field name="integration_date" label="integration_date" type="date" />
				</fields>
				
				<key mode="edit_state">
					<field name="candidate_oid" type="integer" relation="EQ" value="%{property:candidate_oid}" />
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:vacancy_oid}" />
				</key>
				<fields mode="edit_state">
					<field name="etat_oid" label="etat_oid" type="text-choice" control="select" multiple="false" ds="db:rct_candidate_etat.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isKey=""/>
				</fields>
				
				<key mode="edit_state_reader">
					<field name="candidate_oid" type="integer" value="%{request:oid}"/>
					<field name="vacancy_oid" type="integer"  />
				</key>
				<fields mode="edit_state_reader">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="etat_oid" label="etat_oid" type="text-choice" control="select" multiple="false" ds="db:rct_candidate_etat.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isKey=""/>
				</fields>
				
				<key mode="edit_state_reader_update">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" value="%{property:candidate_vacancy_oid}" />
				</key>
				<fields mode="edit_state_reader_update">
					<field name="etat_oid" label="etat_oid" type="text-choice" control="select" multiple="false" ds="db:rct_candidate_etat.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isKey=""/>
				</fields>
				
				
				<!-- 
					Liste des champs
				-->			
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" isProp="key" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="vacancy_oid" label="vacancy_oid" isProp="val" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="add_date" label="add_date" type="timestamp" />
					<field name="rating" label="rating" type="text-choice" list="recruitment.rating" control="select" sqlType="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" />
					<field name="cv_source_oid" label="cv_source_oid" type="ref-oid" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />
					<field name="contrat_signing" label="contrat_signing" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="hire_date" label="hire_date" type="date" />
					<field name="integration_plan" label="integration_plan" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="integration_note" label="integration_note" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="ci_acceptance_date" label="ci_acceptance_date" type="timestamp" />				

					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_date" label="job_acceptance_date" type="timestamp" />

					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" />
					<field name="integration_date" label="integration_date" type="date" />
					<field name="etat_oid" label="etat_oid" type="text-choice" control="select" multiple="false" ds="db:rct_candidate_etat.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" isKey=""/>
				</fields>
			</table>

			

		<!-- 

			Historique des candidats par rapport à un dossier ...

		-->			

			
			<!-- ============  ACTION for a Candidate linked to a vacancy  ============ -->

			<table name="rct_candidate_vacancy_action">
				<key mode="record">
					<field name="oid" type="oid" />
				</key>

				<key mode="ds_list">
				</key>			

				<key mode="by_candidate_vacancy">
					<field name="vacancy_oid" type="ref-oid" relation="EQ" value="%{property:vacancy_oid}"  />
					<field name="candidate_oid" type="ref-oid" relation="EQ" value="%{property:candidate_oid}"  />
				</key>

				<sort mode="by_candidate_vacancy">
					<field name="date" label="date" type="timestamp" direction="desc" />
				</sort>

				<fields>

					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" is_edit="no" />
					<field name="candidate_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />		

					<field name="user_oid" label="user_oid" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
					<field name="date" label="date" type="timestamp" value="now" format="%d/%m/%Y &amp;agrave; %H:%M" />
					<field name="action_oid" label="action_oid" type="text-choice" list="recruitment.vacancy_action" control="select" sqlType="integer" />
					<field name="ref_oid" label="ref_oid" type="ref-oid" sqlType="integer" />
					<field name="additional_infos" label="additional_infos" type="line" />
				</fields>
			</table>


			<!-- ============  CLIENT : SHORT LIST  ============ -->

			<table name="rct_short_list_vacancy_client">
				<query type="select" mode="email_data">

					SELECT
						_rct_short_list._name AS _short_list_name,
						_rct_short_list_vacancy_client._proposed_by AS _proposed_by,
						_rct_short_list_vacancy_client._proposal_date AS _proposal_date,
						_rct_short_list_vacancy_client._comment AS _comment,
						_rct_vacancy._name AS _vacancy_name,
						_rct_vacancy._client_oid AS _client_oid

					FROM
						_rct_short_list_vacancy_client

					LEFT JOIN
						_rct_vacancy ON _rct_vacancy._oid = _rct_short_list_vacancy_client._vacancy_oid

					LEFT JOIN
						_rct_short_list ON _rct_short_list_vacancy_client._short_list_oid = _rct_short_list._oid

					WHERE
						_rct_short_list_vacancy_client._oid = '".$this->getProperty("record_oid")."'

					ORDER BY
						_rct_short_list_vacancy_client._proposal_date DESC

				</query>

			

				<fields mode="email_data">

					<field name="short_list_name" label="short_list_name" type="line" is_transient="true" />
					<field name="proposed_by" label="proposed_by" type="line" is_transient="true" />
					<field name="proposal_date" label="proposal_date" type="line" is_transient="true" />
					<field name="comment" label="comment" type="text" is_transient="true" />
					<field name="vacancy_name" label="vacancy_name" type="line" is_transient="true" />
					<field name="client_oid" label="client_oid" type="line" is_transient="true" />
					<field name="to" label="to" type="line" is_transient="true" />
					<field name="subject" label="subject" type="line" is_transient="true" />
					<field name="body" label="body" type="line" is_transient="true" />
					<field name="files" label="files" type="line" is_transient="true" />
				</fields>			

				<key mode="record">
					<field name="oid" type="oid" />
				</key>

				<key mode="by_sl">
					<field name="short_list_oid" type="ref-oid" value="%{property:short_list_oid}"/>
				</key>

				<fields mode="add">
					<field name="short_list_oid" label="short_list_oid" type="text-choice" value="%{property:short_list_oid}" show="hidden" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" show="hidden" />
					<field name="proposed_by" label="proposed_by" type="text-choice" value="%{user:oid}" show="hidden" />
					<field name="proposal_date" label="cvc_proposal_date" type="timestamp" value="now" show="hidden" />
					<field name="comment" label="cvc_comment" type="text" multiLines="auto" size="255" csslayout="normal-layout" />
				</fields>

				<key mode="by_vacancy">
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" />
				</key>

				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="short_list_oid" label="short_list_oid" type="text-choice" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="proposed_by" label="proposed_by" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
					<field name="proposal_date" label="cvc_proposal_date" type="timestamp" format="%d %B %Y &amp;agrave; %H:%M" />
					<field name="comment" label="cvc_comment" type="text" />
				</fields>
			</table>


			<!-- ============  CLIENT : (candidates,vacancy) sent to client  ============ -->

			<table name="rct_candidate_vacancy_client">
				<query type="select" mode="email_data">
					SELECT
						_rct_candidate_vacancy_client._proposed_by AS _proposed_by,
						_rct_candidate_vacancy_client._proposal_date AS _proposal_date,
						_rct_candidate_vacancy_client._comment AS _comment,

						_rct_vacancy._name AS _vacancy_name,
						_rct_vacancy._client_oid AS _client_oid,

						CONCAT_WS(' ', _rct_candidate._first_name, _rct_candidate._last_name ) AS _candidate,
						_rct_candidate._cv_path as _cv_path,
						_rct_candidate._oid AS _candidate_oid

					FROM
						_rct_candidate_vacancy_client

					LEFT JOIN _rct_vacancy   ON _rct_vacancy._oid   = _rct_candidate_vacancy_client._vacancy_oid				
					LEFT JOIN _rct_candidate ON _rct_candidate._oid = _rct_candidate_vacancy_client._candidate_oid 

					WHERE
						_rct_candidate_vacancy_client._oid = '".$this->getProperty("record_oid")."'

					ORDER BY
						_rct_candidate_vacancy_client._proposal_date DESC

				</query>

				<fields mode="email_data">
					<field name="proposed_by" label="proposed_by" type="line" is_transient="true" />
					<field name="proposal_date" label="proposal_date" type="line" is_transient="true" />
					<field name="comment" label="comment" type="text" is_transient="true" />

					<field name="vacancy_name" label="vacancy_name" type="line" is_transient="true" />
					
					<field name="candidate" label="candidate"  type="line" is_transient="true" />
					<field name="cv_path" label="cv_path"  type="file" is_transient="true" />
					<field name="candidate_oid" label="candidate_oid" type="integer" />

					<field name="client_oid" label="client_oid" type="line" is_transient="true" />				
					<field name="to" label="to" type="line" is_transient="true" />
					<field name="subject" label="subject" type="line" is_transient="true" />
					<field name="body" label="body" type="line" is_transient="true" />
					<field name="files" label="files" type="line" is_transient="true" />
				</fields>

				<key mode="by_vacancy">
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" />
				</key>

				<sort mode="by_vacancy">
					<field name="proposal_date" label="cvc_proposal_date" type="timestamp" direction="DESC" />
				</sort>

				<fields mode="add">
					<field name="candidate_oid" label="candidate_oid" type="text-choice" value="%{property:candidate_oid}" show="hidden" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" show="hidden" />
					<field name="proposed_by" label="proposed_by" type="text-choice" value="%{user:oid}" show="hidden" />
					<field name="proposal_date" label="cvc_proposal_date" type="timestamp" value="now" show="hidden" />
					<field name="comment" label="cvc_comment" type="text" multiLines="auto" size="255" csslayout="normal-layout" />
				</fields>		

				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="candidate_oid" label="candidate_oid" type="text-choice" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="proposed_by" label="proposed_by" type="text-choice" control="select" multiple="false" ds="db:user.ds_list@recruitment" ds_format="{field:first_name} {field:last_name}" ds_field_value="oid" />
					<field name="proposal_date" label="cvc_proposal_date" type="timestamp" format="%d %B %Y &amp;agrave; %H:%M" />
					<field name="comment" label="cvc_comment" type="text" />
					<field 
						name		= "candidates_list" 
						label		= "candidates_list" 
						type		= "records" 
						ds			= "handler:recruitment.candidates_client.proposed"
						ds_record	= "handler:recruitment.candidates_client.proposed"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidates_short_list"
						edit_view	= "recruitment.vacancies_client.components.candidates_short_list"
					/>
				</fields>
			</table>

			<!-- ============  CLIENT : vacancy linked to a manager  ============ -->

			<table name="rct_vacancy_manager">
				<key mode="by_vacancy">
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" />
				</key>		

				<key mode="permission">
					<field name="key" type="ref-oid" relation="EQ" value="%{property:vacancy_id}"  />
					<field name="val" type="ref-oid" relation="EQ" value="%{user:oid}"  />
				</key>
				
				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="key"  type="ref-oid" />
					<field name="val"  type="ref-oid" />
				</fields>
			</table>

			<!-- ============  CLIENT : vacancy linked to a client  ============ -->

			<table name="rct_vacancy_client">
				<key mode="by_vacancy">
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" />
				</key>

				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="key"  type="ref-oid" />
					<field name="val"  type="ref-oid" />
				</fields>
			</table>
			
			<!-- ============  Job Sector : vacancy linked to a sector  ============ -->

			<table name="rct_vacancy_sector">
				<key mode="by_vacancy">
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" value="%{property:vacancy_oid}" />
				</key>

				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="key"  type="ref-oid" />
					<field name="val"  type="ref-oid" />
				</fields>
			</table>

			<!-- ============  HISTORY  ============ -->

			<table name="rct_vacancy_history">		
				<query type="select" mode="by_vacancy">

					SELECT a.*

					FROM _rct_vacancy_history AS a

					LEFT JOIN _rct_vacancy_history AS c ON (

					    SELECT MIN(_oid) FROM _rct_vacancy_history AS b WHERE b._oid > a._oid

					) = c._oid

					WHERE (a._progress_level <> c._progress_level OR c._progress_level IS NULL) AND a._vacancy_oid = '".$props->getProperty("vacancy_oid")."'

					ORDER BY a._date DESC

				</query>
				<query type="select" mode="by_vacancy_resume">

					SELECT *
					FROM _rct_vacancy_history AS a WHERE a._vacancy_oid =".$props->getProperty("vacancy_oid")." AND a._progress_level !=3 AND _progress_level_meta IS NOT NULL AND _progress_level_meta != ''
					UNION SELECT * FROM _rct_vacancy_history AS b
					WHERE _oid = (
						SELECT MAX( _oid )
						FROM _rct_vacancy_history AS b
						WHERE b._vacancy_oid =".$props->getProperty("vacancy_oid")."
						AND b._progress_level =3
						AND _progress_level_meta IS NOT NULL
						AND _progress_level_meta != '' )
					ORDER BY _date DESC

				</query>
				

				<key mode="record">
					<field name="oid" type="oid" />
				</key>
				<key mode="delete_by_poste">
					<field name="vacancy_oid" type="integer" relation="EQ" value="%{property:oid}" />
				</key>

				<fields mode="delete_by_poste">
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
				</fields>

				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="date" label="date" type="timestamp" default="now" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level@recruitment" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="line" /> <!-- Fourre-tout -->
				</fields>
			</table>	
			<table name="rct_vacancy_provider">
				<key mode="record">
					<field name="oid" type="oid" />
				</key>

				<key mode="list">
					<field name="vacancy_oid" type="ref-oid" value="%{property:oid|0}"/>
				</key>
				<key mode="get_id">
					<field name="oid" type="oid" value="%{property:oid}" />
				</key>
				<fields mode="get_id">
					<field name="id_index" label="id_index"  type="line" size="200" show="hidden" />
					<field name="index" label="index" type="integer" show="hidden" />
				</fields>
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary"  isEdit="no" show="hidden" />
					<field name="provider_oid" label="provider_oid" type="text-choice" control="select" multiple="false" ds="db:rct_provider.ds_list" ds_format="{field:name}" prompt="select provider ..." ds_field_value="oid" sqlType="integer" />
					<field name="active" label="active" type="boolean" />
					<field name="date" label="date" type="date" format="%d/%m/%Y" value="now" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" sqlType="integer"  isKey="secondary" show="hidden"/>
					<field name="ref" label="ref" type="line"/>	
					<field name="offer_name" label="offer_name" type="line"/>	
					<!--pointeur vers la dernière candidature récupérée depuis le provider --->
					<field name="id_index" label="id_index"  type="line" size="200" show="hidden" default="0" />
					<field name="index" label="index" type="integer" show="hidden" default="0" />
					
				</fields>

			</table>
			
		</tables>
		
		<views>
			<view name="vacancy_rekrute_count" table="rct_vacancy">
				<query type="select">
					SELECT COUNT(DISTINCT _rct_candidate._oid) as _count_recrute
					from _rct_candidate
					Right JOIN _rct_candidate_vacancy AS VC ON VC._candidate_oid = _rct_candidate._oid
					LEFT JOIN _rct_vacancy ON VC._vacancy_oid = _rct_vacancy._oid
					LEFT JOIN _rct_candidate_etat ON _rct_candidate_etat._oid = _rct_candidate._etat_oid
					
					where  _rct_candidate._archive_state = '0' AND  (_rct_candidate._relevance <> '1' OR _rct_candidate._relevance IS NULL)  AND  _rct_candidate._archive_state = '0' AND VC._vacancy_oid = '".(isset($_REQUEST['vacancy_id'])?$_REQUEST['vacancy_id']:0)."' AND _rct_candidate_etat._vacancy_status = 10
				</query>
				<fields>
					<field name="count_recrute" label="count_recrute" type="integer" />
				</fields>
			</view>
			<view name="directions" table="directory_group">
				<key>
					<field name="group_type" label="group_type" type="text" value="direction" /> 
				</key>
				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="group_name" label="group_name" type="line" />
				</fields>
			</view>
			<view name="edit_email" table="rct_vacancy">
				<key mode="edit_email">
					<field name="oid" label="oid" type="oid" isKey="primary"/>
				</key>
				<fields mode="edit_mail">	
					<field name="email" label="email" type="email" />
				</fields>
			</view>
			
			<view name="poles" table="directory_group">
				<key>
					<field name="group_type" label="group_type" type="text" value="pole" /> 
				</key>
				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="group_name" label="group_name" type="line" />
				</fields>
			</view>

			<view name="rct_vacancy.internal_clients" table="user">
				<query type="select">

					SELECT 
						_oid,
						_first_name,
						_last_name 
					FROM 
						_user
					WHERE 
						_oid IN (SELECT _val FROM _rct_vacancy_client WHERE _key = '".$this->getProperty("vacancy_oid")."')

				</query>

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" show="hidden" />
					<field name="first_name" label="first_name" type="line" />
					<field name="last_name" label="last_name" type="line" />
				</fields>
			</view>
			
			<!-- Vues utilisées au niveau des dossiers -->
			<view name="rct_vacancy_history.by_vacancy" table="rct_vacancy_history">
				<key>
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer"   />
				</key>

				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="date" label="date" type="timestamp" default="now" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level@recruitment" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="line" /> <!-- Fourre-tout -->
				</fields>

				<query type="select">

					SELECT a.*

					FROM _rct_vacancy_history AS a

					LEFT JOIN _rct_vacancy_history AS c ON (

					    SELECT MIN(_oid) FROM _rct_vacancy_history AS b WHERE b._oid > a._oid

					) = c._oid

					WHERE (a._progress_level <> c._progress_level OR c._progress_level IS NULL) AND a._vacancy_oid = '".$_REQUEST['oid']."'

					ORDER BY a._date DESC

				</query>
			
			</view>
			
			<view name="rct_vacancy_history.by_vacancy_resume" table="rct_vacancy_history">
				<fields>
					<field name="oid"  label="oid" type="oid" isKey="primary" show="hidden" isEdit="no"/>
					<field name="date" label="date" type="timestamp" default="now" />
					<field name="vacancy_oid" label="vacancy_oid" type="ref-oid" isKey="secondary" sqlType="integer" />
					<field name="progress_level" label="progress_level" type="text-choice" list="recruitment.vacancy_progress_level@recruitment" control="select" sqlType="integer" />
					<field name="progress_level_meta" label="progress_level_meta" type="line" /> <!-- Fourre-tout -->
				</fields>

				<query type="select">

					SELECT *
					FROM _rct_vacancy_history AS a WHERE a._vacancy_oid =".$props->getProperty("vacancy_oid")." AND a._progress_level !=3 AND _progress_level_meta IS NOT NULL AND _progress_level_meta != ''
					UNION SELECT * FROM _rct_vacancy_history AS b
					WHERE _oid = (
						SELECT MAX( _oid )
						FROM _rct_vacancy_history AS b
						WHERE b._vacancy_oid =".$props->getProperty("vacancy_oid")."
						AND b._progress_level =3
						AND _progress_level_meta IS NOT NULL
						AND _progress_level_meta != '' )
					ORDER BY _date DESC

				</query>
			
			</view>

			<!-- Liste des candidats bien notés -->

			<view 
				name	= "recruitment.candidates.selected"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.selected_list">
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />
					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field name="read_state" label="read_state" type="integer" />
                    <field name="user_read_state" label="user_read_state" type="integer" />
					<field
						name		= "comment"
						label		= "comment"
						type		= "records"
						ds		= "db:rct_candidate_comment.by_candidate_oid"
						ds_record	= "db:rct_candidate_comment.by_candidate_oid"
						key		= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.candidates.components.comments"
						edit_view	= "recruitment.candidates.components.comments"
					/>
				</fields>
			</view>

			<view 
				name	= "recruitment.candidates.selected.record"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.selected_record">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />
					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"

					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies.components.candidate_comments_list"
					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
				</fields>
			</view>
		

			<!-- Liste des candidats bien notés -->
			<view 
				name	= "recruitment.candidates.rated"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.rated_list">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />

                    <field name="read_state" label="read_state" type="integer" />
                    <field name="user_read_state" label="user_read_state" type="integer" />
					<field name="add_date" label="add_date" type="datetime" />
					<field name="studies_level" label="studies_level" type="line" />
					<field name="creation_date" label="creation_date" type="datetime"  />
					<field name="update_date" label="update_date" type="datetime" />
					<field name="last_employment_summary" label="last_employment_summary" type="expression" field="last_employment" control_html="summary" />
					<field name="last_employment_start_date" label="last_employment_start_date" type="date" />
					<field name="last_employment_end_date" label="last_employment_end_date" type="date" />
					<field name="last_employment" label="last_employment" type="text" />
					<field name="last_training_start_date" label="last_training_start_date" type="date" />
					<field name="last_training_end_date" label="last_training_end_date" type="date" />
					<field name="last_training_summary" label="last_training_summary" type="expression" field="last_training" control_html="summary" />
					<field name="last_training" label="last_training" type="text" />
					<field name="relevance" label="relevance" type="text-choice"  list="recruitment.relevance" control="select" sqlType="integer" multiple="false" />
					<field name="etat_oid" label="etat_oid" type="line" is_transient="true" />
					<field name="provider" label = "provider" type="text-choice" control="select" multiple="false" ds="db:rct_provider.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer"/>
					<field name="profile" prompt="profile ..." label="profile" type="text-choice" control="facebook_list" multiple="yes" ds="db:rct_keyword.ds_list" ds_format="{field:name}" ds_field_value="key" csv_sep=","  />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="profile" control_html="summary" />
					<field name="etat_color" label="etat_color" type="line" is_transient="true" />
					<field
                        name		= "viewers"
                        label		= "viewers"
                        type		= "records"
                        ds			= "db:rct_candidate_read_state.by_candidate_oid"
                        ds_record	= "db:rct_candidate_read_state.by_candidate_oid"
                        key			= "oid"
                        fkey		= "candidate_oid"
                        view		= "recruitment.candidates.components.viewers"
                        edit_view	= "recruitment.candidates.components.viewers"
                    />
					<field
						name		= "comment"
						label		= "comment"
						type		= "records"
						ds		= "db:rct_candidate_comment.by_candidate_oid"
						ds_record	= "db:rct_candidate_comment.by_candidate_oid"
						key		= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.candidates.components.comments"
						edit_view	= "recruitment.candidates.components.comments"
					/>
				</fields>
			</view>

			<view 
				name	= "recruitment.candidates.rated.record"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.rated_list_record">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 

						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies.components.candidate_comments_list"
					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
					

				</fields>

			</view>
			

			<!-- Liste des candidats associés au dossier -->

			<view 
				name	= "recruitment.candidates.associated"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.associated_list">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />
					<field name="add_date" label="add_date" type="datetime" />
					<field name="studies_level" label="studies_level" type="line" />
					<field name="creation_date" label="creation_date" type="datetime"  />
					<field name="update_date" label="update_date" type="datetime" />
					<field name="last_employment_summary" label="last_employment_summary" type="expression" field="last_employment" control_html="summary" />
					<field name="last_employment_start_date" label="last_employment_start_date" type="date" />
					<field name="last_employment_end_date" label="last_employment_end_date" type="date" />
					<field name="last_employment" label="last_employment" type="text" />
					<field name="last_training_start_date" label="last_training_start_date" type="date" />
					<field name="last_training_end_date" label="last_training_end_date" type="date" />
					<field name="last_training_summary" label="last_training_summary" type="expression" field="last_training" control_html="summary" />
					<field name="last_training" label="last_training" type="text" />
					<field name="relevance" label="relevance" type="text-choice"  list="recruitment.relevance" control="select" sqlType="integer" multiple="false" />
					<field name="etat_oid" label="etat_oid" type="line" is_transient="true" />
					<field name="etat_color" label="etat_color" type="line" is_transient="true" />
					<field name="provider" label = "provider" type="text-choice" control="select" multiple="false" ds="db:rct_provider.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer"/>
					<field name="profile" prompt="profile ..." label="profile" type="text-choice" control="facebook_list" multiple="yes" ds="db:rct_keyword.ds_list" ds_format="{field:name}" ds_field_value="key" csv_sep=","  />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="profile" control_html="summary" />
				    <field name="read_state" label="read_state" type="integer" />
                    <field name="user_read_state" label="user_read_state" type="integer" />
                    <field
                        name		= "viewers"
                        label		= "viewers"
                        type		= "records"
                        ds			= "db:rct_candidate_read_state.by_candidate_oid"
                        ds_record	= "db:rct_candidate_read_state.by_candidate_oid"
                        key			= "oid"
                        fkey		= "candidate_oid"
                        view		= "recruitment.candidates.components.viewers"
                        edit_view	= "recruitment.candidates.components.viewers"
                    />
					<field
						name		= "comment"
						label		= "comment"
						type		= "records"
						ds		= "db:rct_candidate_comment.by_candidate_oid"
						ds_record	= "db:rct_candidate_comment.by_candidate_oid"
						key		= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.candidates.components.comments"
						edit_view	= "recruitment.candidates.components.comments"
					/>
				</fields>
			</view>
			<view name="recruitment.candidates.associated.log" table="rct_candidate">
				<key>
					<field name="oid" type="oid" />
				</key>
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>
				</fields>
			</view>

			<view 
				name	= "recruitment.candidates.associated.record"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.associated_list_record">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"

					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "rct_candidate_vacancy_comment.ds_list"
						ds_record	= "rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies.components.candidate_comments_list"
					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
				</fields>
			</view>

			<!-- Liste des candidats refusés -->

			<view 
				name	= "recruitment.candidates.refused"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.refused_list">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />	
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />
                    <field name="read_state" label="read_state" type="integer" />
                    <field name="user_read_state" label="user_read_state" type="integer" />

					<field name="add_date" label="add_date" type="datetime" />
					<field name="studies_level" label="studies_level" type="line" />
					<field name="creation_date" label="creation_date" type="datetime"  />
					<field name="update_date" label="update_date" type="datetime" />
					<field name="last_employment_summary" label="last_employment_summary" type="expression" field="last_employment" control_html="summary" />
					<field name="last_employment_start_date" label="last_employment_start_date" type="date" />
					<field name="last_employment_end_date" label="last_employment_end_date" type="date" />
					<field name="last_employment" label="last_employment" type="text" />
					<field name="last_training_start_date" label="last_training_start_date" type="date" />
					<field name="last_training_end_date" label="last_training_end_date" type="date" />
					<field name="last_training_summary" label="last_training_summary" type="expression" field="last_training" control_html="summary" />
					<field name="last_training" label="last_training" type="text" />
					<field name="relevance" label="relevance" type="text-choice"  list="recruitment.relevance" control="select" sqlType="integer" multiple="false" />
					<field name="etat_oid" label="etat_oid" type="line" is_transient="true" />
					<field name="etat_color" label="etat_color" type="line" is_transient="true" />
					<field name="provider" label = "provider" type="text-choice" control="select" multiple="false" ds="db:rct_provider.ds_list" ds_format="{field:name}" ds_field_value="oid" sqlType="integer"/>
					<field name="profile" prompt="profile ..." label="profile" type="text-choice" control="facebook_list" multiple="yes" ds="db:rct_keyword.ds_list" ds_format="{field:name}" ds_field_value="key" csv_sep=","  />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="profile" control_html="summary" />
					<field name="etat_color" label="etat_color" type="line" is_transient="true" />
					<field
                        name		= "viewers"
                        label		= "viewers"
                        type		= "records"
                        ds			= "db:rct_candidate_read_state.by_candidate_oid"
                        ds_record	= "db:rct_candidate_read_state.by_candidate_oid"
                        key			= "oid"
                        fkey		= "candidate_oid"
                        view		= "recruitment.candidates.components.viewers"
                        edit_view	= "recruitment.candidates.components.viewers"
                    />
					<field
						name		= "comment"
						label		= "comment"
						type		= "records"
						ds		= "db:rct_candidate_comment.by_candidate_oid"
						ds_record	= "db:rct_candidate_comment.by_candidate_oid"
						key		= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.candidates.components.comments"
						edit_view	= "recruitment.candidates.components.comments"
					/>
				</fields>

			</view>

			<view 
				name	= "recruitment.candidates.refused.record"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.refused_list_record">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"

					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies.components.candidate_comments_list"
					/>			
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>

				</fields>

			</view>
			

			<!-- Résultat de recherche des candidats associés au dossier -->

			<view 
				name	= "recruitment.candidates.search_list"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates.search_list">

				<fields>

					

					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />	

					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />
					

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />

					

					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>		

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>			

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_log"
						edit_view	= "recruitment.vacancies.components.candidate_log"
					/>					

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies.components.candidate_comments_list"
					/>		
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>

				</fields>

			</view>

			<view 
				name	= "recruitment.vacancy.list"
				table	= "rct_vacancy" 
				>
				<query type="select">
					SELECT distinct _rct_vacancy._oid , _rct_vacancy._name,
						_rct_vacancy._code FROM _rct_vacancy 
						LEFT JOIN _rct_vacancy_total_control AS T_CTRL ON T_CTRL._key = _rct_vacancy._oid 
						LEFT JOIN _rct_vacancy_readonly		 AS R_CTRL ON R_CTRL._key = _rct_vacancy._oid
						where _rct_vacancy._current_step = 0 AND (
							_rct_vacancy._creator='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							T_CTRL._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							R_CTRL._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							_rct_vacancy._manager_oid='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							_rct_vacancy._creator in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							T_CTRL._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							R_CTRL._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							_rct_vacancy._manager_oid in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') )
				</query>
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="name" label="name" type="line"/>
					<field name="code" label="code" type="line"/>
				</fields>
			</view>
			
			<view 
				name	= "recruitment.vacancy.list_all"
				table	= "rct_vacancy" 
				>
				<query type="select">
					SELECT distinct _rct_vacancy._oid , _rct_vacancy._name,
						_rct_vacancy._code FROM _rct_vacancy 
						LEFT JOIN _rct_vacancy_total_control AS T_CTRL ON T_CTRL._key = _rct_vacancy._oid 
						LEFT JOIN _rct_vacancy_readonly		 AS R_CTRL ON R_CTRL._key = _rct_vacancy._oid
						where (
							_rct_vacancy._creator='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							T_CTRL._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							R_CTRL._val='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							_rct_vacancy._manager_oid='".$GLOBALS["_NX_user"]->getProperty("user.oid","",true)."' OR 
							_rct_vacancy._creator in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							T_CTRL._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							R_CTRL._val in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') OR 
							_rct_vacancy._manager_oid in (select _oid from _user where `_interim` = '".$GLOBALS["_NX_user"]->getProperty("oid","")."') )
						Order by _rct_vacancy._name Asc
				</query>
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="name" label="name" type="line"/>
					<field name="code" label="code" type="line"/>
				</fields>
			</view>
			
			<view 
				name	= "recruitment.vacancy.list.drh"
				table	= "rct_vacancy" 
				>
				<query type="select">
					SELECT _rct_vacancy._oid , _rct_vacancy._name,
						_rct_vacancy._code FROM _rct_vacancy 
						where _rct_vacancy._current_step = 0 
				</query>
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="name" label="name" type="line"/>
					<field name="code" label="code" type="line"/>
				</fields>
			</view>

			<view 
				name	= "recruitment.vacancy.list_all.drh"
				table	= "rct_vacancy" 
				>
				<query type="select">
					SELECT _rct_vacancy._oid , _rct_vacancy._name,
						_rct_vacancy._code FROM _rct_vacancy 
						Order by _name Asc
				</query>
				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="name" label="name" type="line"/>
					<field name="code" label="code" type="line"/>
				</fields>
			</view>

			

			<view 

				name	= "recruitment.candidates.log.candidate_log"
				table	= "rct_candidate_vacancy_action" 
				handler	= "lib.recruitment.vacancies.records.candidates.log.log">

				<fields>

					<field name="candidate_oid" type="integer" isKey="secondary" />
					<field name="vacancy_oid" type="integer" isKey="secondary" />
					<field name="user_oid" type="integer" isKey="secondary" />
					<field name="date" type="timestamp" format="%d/%m/%Y &amp;agrave; %H:%M" />
					<field name="action_oid" type="integer" isKey="secondary" />
					<field name="ref_oid" type="integer" isKey="secondary" />
					<field name="additional_infos" type="line" />
					<field name="candidate_full_name" type="line" />
					<field name="user_full_name" type="line" />
					<field name="short_list_name" type="line" />

				</fields>

			</view>

			

			<view 

				name	= "recruitment.candidates.log.candidate_interviews"
				table	= "rct_candidate_vacancy_action" 
				handler	= "lib.recruitment.vacancies.records.candidates.log.interviews">

				<fields>

					<field name="candidate_oid" type="integer" isKey="secondary" />
					<field name="vacancy_oid" type="integer" isKey="secondary" />
					<field name="user_oid" type="integer" isKey="secondary" />
					<field name="date" type="timestamp" format="%d/%m/%Y &amp;agrave; %H:%M" />
					<field name="action_oid" type="integer" isKey="secondary" />
					<field name="ref_oid" type="integer" isKey="secondary" />
					<field name="additional_infos" type="line" />
					<field name="candidate_full_name" type="line" />
					
					<field name="interviewer_full_name" type="line" />
					<field name="user_full_name" type="line" />
					<field name="short_list_name" type="line" />

					<field name="interview_date" type="date" format="%d/%m/%Y" />
					<field name="interview_time_start" type="timestamp" format="%H:%M" />

				</fields>				

			</view>

			

			<view
				name	= "recruitment.candidates.log.candidate_emails"
				table	= "rct_candidate_vacancy_action" 
				handler	= "lib.recruitment.vacancies.records.candidates.log.emails">

				<fields>

					<field name="candidate_oid" type="integer" isKey="secondary" />
					<field name="vacancy_oid" type="integer" isKey="secondary" />
					<field name="user_oid" type="integer" isKey="secondary" />
					<field name="date" type="timestamp" format="%d/%m/%Y &amp;agrave; %H:%M" />
					<field name="action_oid" type="integer" isKey="secondary" />
					<field name="ref_oid" type="integer" isKey="secondary" />
					<field name="additional_infos" type="line" />
					<field name="candidate_full_name" type="line" />
					<field name="user_full_name" type="line" />
					<field name="short_list_name" type="line" />	

				</fields>				

			</view>
			

			<!-- Vues client -->	

			<!-- Liste des candidats bien notés -->

			<view 

				name	= "recruitment.candidates_client.selected"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates_client.selected_list">

				<fields>		

					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />					

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />

					

					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"

					/>

					

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies_client.components.candidate_comments_list"

					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
					

				</fields>

			</view>

			
			

			<!-- Liste des candidats bien notés -->

			<view 

				name	= "recruitment.candidates_client.rated"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates_client.rated_list">

				<fields>

					

					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />

					

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />

					

					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>			

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies_client.components.candidate_comments_list"
					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
				</fields>

			</view>

			

			<!-- Liste des candidats associés au dossier -->

			<view 

				name	= "recruitment.candidates_client.associated"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates_client.associated_list">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />
					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>				

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "rct_candidate_vacancy_comment.ds_list"
						ds_record	= "rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies_client.components.candidate_comments_list"
					/>					
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
				</fields>

			</view>

			

			<!-- Liste des candidats refusés -->

			<view 

				name	= "recruitment.candidates_client.proposed"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates_client.proposed_list">

				<fields>

					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />	

					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />

					

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />

					

					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>					

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies_client.components.candidate_comments_list"
					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>
				</fields>
			</view>
			
			


			<!-- Résultat de recherche des candidats associés au dossier -->
			<view 
				name	= "recruitment.candidates_client.search_list"
				table	= "rct_candidate" 
				handler	= "lib.recruitment.vacancies.records.candidates_client.search_list">

				<fields>
					<field name="oid" label="oid" type="oid" isKey="primary" isEdit="no" show="hidden" />
					<field name="candidate_oid" label="candidate_oid" type="expression" value="{field.object:oid}" isKey="secondary" />
					<field name="assoc_oid" type="integer" isKey="secondary" />
					<field name="first_name" label="first_name"  type="line" />
					<field name="last_name" label="last_name"  type="line" />
					<field name="age" label="age" type="line" is_transient="true" />
					<field name="town_name" label="town_name" type="line" is_transient="true" />
					<field name="diploma_type" label="diploma_type" type="line" is_transient="true" />
					<field name="institution" label="institution" type="line" is_transient="true" />
					<field name="cv_path" label="cv_path" type="line" />
					<field name="years_of_practice" label="years_of_practice" type="integer" />
					<field name="keywords" label="keywords" type="text" multiLines="auto" show="hidden" />
					<field name="summary_keywords" label="summary_keywords" type="expression" field="keywords" control_html="summary" />
					<field name="rating" label="rating" type="integer" />
					<field name="status" label="status" type="text-choice" list="recruitment.candidate_vacancy_action" control="select" sqlType="integer" />	

					<field name="is_visible" label="is_visible" type="text-choice" list="recruitment.boolean_list" control="select" sqlType="integer" control="checkbox" multiple="false" default="0" sqlType="integer" isKey="secondary" />		

					<field name="ci_acceptance_state" label="ci_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="job_acceptance_state" label="job_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />
					<field name="proposal_acceptance_state" label="proposal_acceptance_state" type="text-choice" list="recruitment.acceptance_list" control="select" sqlType="integer" multiple="false" default="0" sqlType="integer" />

					<field name="proposal_acceptance_date" label="proposal_acceptance_date" type="date" format="%d %B %Y" />
					<field 
						name		= "candidate_log" 
						label		= "candidate_log" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_log"
						ds_record	= "handler:recruitment.candidates.log.candidate_log"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_interviews" 
						label		= "candidate_interviews" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_interviews"
						ds_record	= "handler:recruitment.candidates.log.candidate_interviews"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					<field 
						name		= "candidate_emails" 
						label		= "candidate_emails" 
						type		= "records" 
						ds			= "handler:recruitment.candidates.log.candidate_emails"
						ds_record	= "handler:recruitment.candidates.log.candidate_emails"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_log"
						edit_view	= "recruitment.vacancies_client.components.candidate_log"
					/>

					

					<field 
						name		= "candidate_comments" 
						label		= "candidate_comments" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy_comment.ds_list"
						ds_record	= "db:rct_candidate_vacancy_comment.ds_list"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies_client.components.candidate_comments_list"
						edit_view	= "recruitment.vacancies_client.components.candidate_comments_list"
					/>
					<field 
						name		= "candidate_vacancies" 
						label		= "candidate_vacancies" 
						type		= "records" 
						ds			= "db:rct_candidate_vacancy.candidate_vacancies_c"
						ds_record	= "db:rct_candidate_vacancy.candidate_vacancies_c"
						key			= "oid"
						fkey		= "candidate_oid"
						view		= "recruitment.vacancies.components.candidate_vacancies_list"
						edit_view	= "recruitment.vacancies.components.candidate_vacancies_list"
					/>		

				</fields>
			</view>


				<!-- 
				
						API WEB : annonces site web 
						
				-->


			<view 

				name	= "rct_vacancy.pub_web_site"
				table	= "rct_vacancy" 
				handler	= "lib.recruitment.vacancies.records.api">

				<fields>

					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="show" />

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="email" alias="email"  label="email" type="line" />
					<field name="number" label="number" type="integer" default="1"/>
					<field name="code" label="code" type="line" />
					<field name="opening_date" type="date" />
					<field name="duty_station_oid" label="duty_station_oid" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list@recruitment" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />

					<field name="salaire" label="salaire" type="line" />
					<field name="descriptionEntreprise" label="descriptionEntreprise" type="rich-text" csslayout="normal-layout"  />
					<field name="descriptionPoste" label="descriptionPoste" type="rich-text" csslayout="normal-layout" />
					<field name="descriptionProfil" label="descriptionProfil" type="rich-text" csslayout="normal-layout" />
					<field name="date" label="date" type="date" format="%d/%m/%Y" value="now" />
					<field name="duree" label="duree" type="line" />
					<field name="nombrePoste" label="nombrePoste" type="line" /> 
					<field name="startDate" label="startDate" type="date" format="%d/%m/%Y" />
					<field name="endDate" label="endDate" type="date" format="%d/%m/%Y" />

				</fields>
			</view>
			
			<view name = "rct_vacancy.pub_app_compagnie" table= "rct_app_connected" >
				<key>
					<field name="key" label="key" value="%{request:key}" type="line" size="200" />
				</key>

				<fields>
					<field name="oid" label="object_id" type="oid" isKey="primary" show="hidden" isEdit="no" />
					<field name="name" label="name"  type="line" size="200" />
					<field name="url" label="url"  type="line" size="200" />
					<field name="compagnie_name" label="compagnie_name"  type="line" size="200" />
					<field name="description" label="description" type="text" multiLines="auto" size="255" />
					<field name="contact_email" label="contact_email" type="email" />
					<field name="logo" label="logo" type="image" maxSize="200000" imageSize="original" />
				</fields>
			</view>
			<view name = "rct_vacancy.pub_app" table= "rct_vacancy" >
				<query type="select">
					SELECT 
						V._oid AS _oid,
						V._cand_channel AS _cand_channel,
						V._name AS _name,
						V._email AS _email,
						V._number AS _number,
						V._code AS _code,
						V._opening_date AS _opening_date,
						V._contract_type_oid AS _contract_type_oid,
						V._duty_station_oid AS _duty_station_oid,

						V._mission_definitions AS _mission_definitions,
						V._organisme_definitions AS _organisme_definitions,
						V._descriptionProfil AS _descriptionProfil,
						V._technical_qualifications AS _technical_qualifications,
						V._behavioral_qualifications AS _behavioral_qualifications,
						
						
						V._work_schedule AS _work_schedule,
						V._suited_diplomas AS _suited_diplomas,
						V._companies_having_same_profile AS _companies_having_same_profile,
						V._mission_means AS _mission_means,
						V._years_of_practice AS _years_of_practice,
						CA._url AS _url,
						CA._description As _description

					FROM 
						_rct_vacancy AS V 
						RIGHT JOIN _rct_app_connected as CA ON  V._app_connected like CONCAT('%|', CA._oid ,'|%')

					WHERE 
						V._current_step='0' AND (V._closing_announce_date IS NULL OR V._closing_announce_date > NOW() ) AND
						(V._archive_state = '0') AND 
						(V._workflow_state='1' OR V._workflow_state='2') AND 
						V._app_connected IS NOT NULL
						AND CA._url like '%".$_REQUEST['origine']."%'
						-- AND CA._key = '".$_REQUEST['key']."'
						
					GROUP BY 
						V._oid  

					ORDER BY 
						V._opening_date DESC,
						V._name ASC,
						V._code ASC
				</query>

				<fields>
					<field name="oid" alias="oid" label="oid" type="oid" isKey="primary" show="show" />

					<!-- Colonne 1 -->
					<field name="name" alias="name"  label="name" type="line" />
					<field name="email" alias="email"  label="email" type="line" />
					<field name="number" alias="number"  label="number" type="integer" default="1" />
					<field name="code" alias="code" label="code" type="line" />
					<field name="opening_date" alias="opening_date" type="date" format="%d/%m/%Y" />
					<field name="duty_station_oid" label="duty_station_oid" alias="duty_station" type="text-choice" control="select" multiple="false" ds="db:rct_duty_station.ds_list@recruitment" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" prompt="duty_station_oid..." />
					<field name="contract_type_oid" label="contract_type_oid" alias="contract_type" type="text-choice-table" control="radio" columns="4" multiple="false" ds="db:rct_contract_type.ds_list@recruitment" ds_format="{field:name}" ds_field_value="oid" sqlType="integer" />
					
					<field name="mission_definitions" label="mission_definitions" alias="mission_definitions" type="rich-text" csslayout="normal-layout" />
					<field name="organisme_definitions" label="organisme_definitions" alias="organisme_definitions" type="rich-text" csslayout="normal-layout" />
					<field name="descriptionProfil" label="descriptionProfil" alias="profil_description" type="rich-text" csslayout="normal-layout" />
					<field name="behavioral_qualifications" label="behavioral_qualifications" alias="behavioral_qualifications" type="rich-text" />
					<field name="url" label="url" type="line" alias="url" />
					<field name="technical_qualifications" label="technical_qualifications" alias="technical_qualifications" type="rich-text" />
					<field name="suited_diplomas" label="suited_diplomas" type="text" alias="vacancy_diplomas" />
					<field name="work_schedule" label="work_schedule" type="line" alias="work_schedule"/>
					<field name="years_of_practice"	type="integer" alias="years_of_practice"/>
					<field name="companies_having_same_profile" label="companies_having_same_profile" type="text" alias="companies_having_same_profile" />
					<field name="mission_means" label="mission_means" alias="mission_means" type="rich-text" />
					<field name="description" label="description" type="rich-text" alias="entreprise_description" />
					
				</fields>
			</view>

		</views>
	</data>
</nxl>